<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Salmoiraghi & Vigan√≤ - Cesano Boscone | Digital Boutique</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0a1628">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="S&V Boutique">
    <meta name="description" content="La tua boutique Salmoiraghi & Vigan√≤ sempre in tasca. Prenota visite, scopri promozioni esclusive, prova virtualmente gli occhiali.">
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LX1EQS2ESC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        
        gtag('consent', 'default', {
            'analytics_storage': 'denied',
            'ad_storage': 'denied'
        });
        
        gtag('js', new Date());
        gtag('config', 'G-LX1EQS2ESC', {
            'anonymize_ip': true,
            'allow_google_signals': false,
            'allow_ad_personalization_signals': false
        });
    </script>
    
    <!-- Luxottica Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --midnight: #0a1628;
            --champagne: #d4af37;
            --pearl: #fafafa;
            --silk: #f5f5f0;
            --smoke: #e5e5e5;
            --steel: #737373;
            --shadow: rgba(10, 22, 40, 0.1);
            --glass: rgba(250, 250, 250, 0.95);
            --emerald: #50c878;
            --ruby: #e0115f;
            --sapphire: #0f52ba;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--pearl) 0%, var(--silk) 100%);
            color: var(--midnight);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        /* Preloader - Fixed for iOS/Android */
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: var(--midnight);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }

        .preloader.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .logo-animation {
            width: 120px;
            height: 120px;
            position: relative;
        }

        .logo-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid var(--champagne);
            border-radius: 50%;
            opacity: 0;
            animation: ringPulse 2s infinite;
        }

        .logo-ring:nth-child(2) {
            animation-delay: 0.3s;
        }

        .logo-ring:nth-child(3) {
            animation-delay: 0.6s;
        }

        @keyframes ringPulse {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        /* Header */
        header {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(212, 175, 55, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--midnight);
            letter-spacing: -0.5px;
            text-decoration: none;
            cursor: pointer;
        }

        .brand span {
            color: var(--champagne);
            font-weight: 400;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.1);
            z-index: 999;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            border-top: 1px solid var(--smoke);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: var(--steel);
            position: relative;
        }

        .nav-item.active {
            color: var(--champagne);
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
            transition: transform 0.3s;
        }

        .nav-item:hover .nav-icon {
            transform: translateY(-2px);
        }

        .nav-label {
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Page Container */
        .page {
            display: none;
            animation: pageIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page.active {
            display: block;
        }

        @keyframes pageIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Hero Section */
        .hero {
            min-height: 50vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            margin-bottom: 40px;
            background: radial-gradient(circle at 20% 50%, rgba(212, 175, 55, 0.1), transparent 50%);
        }

        .hero-content {
            text-align: center;
            z-index: 1;
            padding: 40px 20px;
        }

        .hero-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(32px, 7vw, 56px);
            font-weight: 400;
            margin-bottom: 16px;
            line-height: 1.2;
        }

        .hero-subtitle {
            font-weight: 300;
            font-size: clamp(14px, 3vw, 18px);
            color: rgba(10, 22, 40, 0.7);
            margin-bottom: 24px;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 24px 0;
            flex-wrap: wrap;
        }

        .quick-btn {
            background: linear-gradient(135deg, var(--champagne), #b8941f);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 30px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        .quick-btn.secondary {
            background: white;
            color: var(--midnight);
            box-shadow: 0 4px 15px var(--shadow);
        }

        /* Service Cards */
        .services-grid {
            padding: 0 20px;
            max-width: 1200px;
            margin: 0 auto 40px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }

        .service-card {
            background: white;
            border-radius: 20px;
            padding: 24px 16px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            box-shadow: 0 5px 20px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--champagne), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }

        .service-card:hover::before {
            transform: translateX(100%);
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(10, 22, 40, 0.15);
        }

        .service-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 12px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.2));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .service-title {
            font-family: 'Playfair Display', serif;
            font-size: 16px;
            margin-bottom: 8px;
            color: var(--midnight);
        }

        .service-desc {
            font-size: 12px;
            font-weight: 300;
            color: var(--steel);
            line-height: 1.4;
        }

        /* Promo Timer */
        .promo-banner {
            background: linear-gradient(135deg, var(--ruby), #c0105f);
            color: white;
            padding: 20px;
            margin: 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(224, 17, 95, 0.3);
        }

        .promo-title {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .promo-timer {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .timer-block {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 16px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .timer-number {
            font-size: 28px;
            font-weight: 700;
            display: block;
        }

        .timer-label {
            font-size: 10px;
            text-transform: uppercase;
            opacity: 0.9;
        }

        /* Fortune Wheel */
        .wheel-container {
            max-width: 400px;
            margin: 40px auto;
            padding: 30px;
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px var(--shadow);
        }

        .wheel-wrapper {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 0 auto 30px;
        }

        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                var(--champagne) 0deg 60deg,
                var(--midnight) 60deg 120deg,
                var(--champagne) 120deg 180deg,
                var(--midnight) 180deg 240deg,
                var(--champagne) 240deg 300deg,
                var(--midnight) 300deg 360deg
            );
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            position: relative;
            will-change: transform;
        }

        .wheel-prizes {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .prize-text {
            position: absolute;
            color: white;
            font-size: 11px;
            font-weight: 700;
            text-align: center;
            transform-origin: center;
            width: 90px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            color: var(--midnight);
            z-index: 10;
        }

        .wheel-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid var(--champagne);
            filter: drop-shadow(0 3px 10px rgba(0, 0, 0, 0.3));
            z-index: 11;
        }

        .spin-button {
            width: 100%;
            background: linear-gradient(135deg, var(--midnight), #1a2c48);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .spin-button:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(10, 22, 40, 0.3);
        }

        .spin-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 22, 40, 0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .modal.active {
            display: flex;
            animation: modalFadeIn 0.3s;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 30px;
            padding: 40px 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            animation: modalSlideUp 0.4s;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes modalSlideUp {
            from { 
                opacity: 0;
                transform: translateY(50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--silk);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 20px;
            color: var(--midnight);
        }

        .modal-close:hover {
            background: var(--champagne);
            color: white;
            transform: rotate(90deg);
        }

        /* Store Info Card */
        .store-info {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px;
            box-shadow: 0 10px 40px var(--shadow);
        }

        .store-info h2 {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            margin-bottom: 20px;
            color: var(--midnight);
        }

        .info-row {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--smoke);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.2));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .info-text {
            flex: 1;
        }

        .info-label {
            font-size: 12px;
            color: var(--steel);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 16px;
            color: var(--midnight);
            font-weight: 500;
        }

        .info-value a {
            color: inherit;
            text-decoration: none;
            transition: color 0.3s;
        }

        .info-value a:hover {
            color: var(--champagne);
        }

        /* Guide Section */
        .guides-container {
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .guide-card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px var(--shadow);
            cursor: pointer;
            transition: all 0.3s;
        }

        .guide-card:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 30px var(--shadow);
        }

        .guide-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .guide-title {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            color: var(--midnight);
        }

        .guide-icon {
            font-size: 24px;
            color: var(--champagne);
            transition: transform 0.3s;
        }

        .guide-card:hover .guide-icon {
            transform: rotate(45deg);
        }

        .guide-content {
            display: none;
            padding-top: 16px;
            border-top: 1px solid var(--smoke);
            animation: slideDown 0.3s;
        }

        .guide-content.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .guide-text {
            color: var(--steel);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .guide-tip {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.05), rgba(212, 175, 55, 0.1));
            padding: 16px;
            border-radius: 12px;
            border-left: 3px solid var(--champagne);
            margin-top: 16px;
        }

        .guide-tip-title {
            font-weight: 600;
            color: var(--midnight);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Reviews Section */
        .reviews-section {
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .review-card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 5px 20px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .review-card::before {
            content: '"';
            position: absolute;
            top: -20px;
            left: 20px;
            font-size: 80px;
            color: rgba(212, 175, 55, 0.1);
            font-family: 'Playfair Display', serif;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .review-author {
            font-weight: 600;
            color: var(--midnight);
        }

        .review-rating {
            color: var(--champagne);
            font-size: 14px;
        }

        .review-text {
            color: var(--steel);
            line-height: 1.6;
            font-style: italic;
            margin-bottom: 8px;
        }

        .review-date {
            font-size: 12px;
            color: rgba(10, 22, 40, 0.4);
        }

        .review-cta {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 30px auto;
            padding: 18px;
            background: linear-gradient(135deg, var(--champagne), #b8941f);
            color: white;
            text-align: center;
            border-radius: 15px;
            text-decoration: none;
            font-weight: 500;
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
            transition: all 0.3s;
        }

        .review-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(212, 175, 55, 0.4);
        }

        /* Footer */
        .footer {
            background: var(--midnight);
            color: white;
            padding: 40px 20px 100px;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .footer-brand {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            margin-bottom: 20px;
        }

        .footer-text {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .footer-link {
            color: var(--champagne);
            text-decoration: none;
            transition: opacity 0.3s;
        }

        .footer-link:hover {
            opacity: 0.8;
        }

        /* Install Prompt */
        .install-prompt {
            position: fixed;
            bottom: 90px;
            left: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.1);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 998;
            transform: translateY(200%);
        }

        .install-prompt.show {
            transform: translateY(0);
        }

        .install-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .install-text {
            flex: 1;
        }

        .install-title {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            margin-bottom: 4px;
            color: var(--midnight);
        }

        .install-desc {
            font-size: 14px;
            color: var(--steel);
        }

        .install-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .install-button {
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .install-button.primary {
            background: var(--champagne);
            color: white;
        }

        .install-button.secondary {
            background: var(--silk);
            color: var(--midnight);
        }

        /* Cookie Banner */
        .cookie-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--midnight);
            color: white;
            padding: 20px;
            z-index: 9998;
            transform: translateY(100%);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.2);
        }

        .cookie-banner.show {
            transform: translateY(0);
        }

        .cookie-content {
            max-width: 1000px;
            margin: 0 auto;
            text-align: center;
        }

        .cookie-title {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            margin-bottom: 12px;
            color: var(--champagne);
        }

        .cookie-text {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .cookie-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .cookie-btn {
            padding: 12px 24px;
            border-radius: 25px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .cookie-btn.accept {
            background: var(--champagne);
            color: var(--midnight);
        }

        .cookie-btn.accept:hover {
            background: #b8941f;
            transform: translateY(-2px);
        }

        .cookie-btn.customize {
            background: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .cookie-btn.customize:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .cookie-btn.reject {
            background: var(--steel);
            color: white;
        }

        /* Privacy Settings Modal */
        .privacy-modal .modal-content {
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .privacy-section {
            margin-bottom: 30px;
            text-align: left;
        }

        .privacy-section h3 {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            margin-bottom: 12px;
            color: var(--midnight);
        }

        .privacy-section p {
            color: var(--steel);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .consent-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--silk);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .toggle-info {
            flex: 1;
        }

        .toggle-title {
            font-weight: 600;
            color: var(--midnight);
            margin-bottom: 4px;
        }

        .toggle-desc {
            font-size: 13px;
            color: var(--steel);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            margin-left: 16px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--steel);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: .4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--champagne);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .services-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .promo-timer {
                gap: 8px;
            }
            
            .timer-block {
                padding: 8px 12px;
            }
            
            .timer-number {
                font-size: 20px;
            }
            
            .wheel-wrapper {
                width: 240px;
                height: 240px;
            }
            
            .prize-text {
                font-size: 9px;
                width: 60px;
            }

            .install-content {
                flex-direction: column;
                text-align: center;
            }

            .install-buttons {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .hero-title {
                font-size: 28px;
            }
            
            .modal-content {
                margin: 20px;
                padding: 30px 20px;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .quick-btn {
                width: 200px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div class="preloader" id="preloader">
        <div class="logo-animation">
            <div class="logo-ring"></div>
            <div class="logo-ring"></div>
            <div class="logo-ring"></div>
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--champagne); font-family: 'Playfair Display', serif; font-size: 32px;">S&V</div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="header-content">
            <a href="#home" class="brand" onclick="navigateTo('home')">Salmoiraghi <span>&</span> Vigan√≤</a>
        </div>
    </header>

    <!-- HOME PAGE -->
    <div id="home-page" class="page active">
        <section class="hero">
            <div class="hero-content">
                <h1 class="hero-title">La tua vista,<br>la nostra passione</h1>
                <p class="hero-subtitle">Boutique Cesano Boscone ‚Ä¢ Le Porte di Milano</p>
                <div class="quick-actions">
                    <a href="tel:+390245862417" class="quick-btn" onclick="trackPhoneClick('hero')">
                        üìû Chiama
                    </a>
                    <a href="https://wa.me/390245862417?text=Salve,%20vorrei%20informazioni%20sui%20vostri%20servizi" target="_blank" class="quick-btn secondary" onclick="trackWhatsAppClick('hero')">
                        üí¨ WhatsApp
                    </a>
                </div>
            </div>
        </section>

        <div class="promo-banner">
            <h2 class="promo-title">üéÅ Offerta del Giorno</h2>
            <p style="margin-bottom: 16px;">Seconda coppia al 50% di sconto!</p>
            <div class="promo-timer">
                <div class="timer-block">
                    <span class="timer-number" id="timer-hours">24</span>
                    <span class="timer-label">Ore</span>
                </div>
                <div class="timer-block">
                    <span class="timer-number" id="timer-minutes">00</span>
                    <span class="timer-label">Min</span>
                </div>
                <div class="timer-block">
                    <span class="timer-number" id="timer-seconds">00</span>
                    <span class="timer-label">Sec</span>
                </div>
            </div>
        </div>

        <div class="services-grid">
            <div class="service-card" onclick="navigateTo('prenota')">
                <div class="service-icon">üìÖ</div>
                <h3 class="service-title">Prenota</h3>
                <p class="service-desc">Visita oculistica o consulenza</p>
            </div>
            
            <div class="service-card" onclick="navigateTo('clubete')">
                <div class="service-icon">üíé</div>
                <h3 class="service-title">Club &Te</h3>
                <p class="service-desc">3 occhiali in 3 anni da 20‚Ç¨/mese</p>
            </div>
            
            <div class="service-card" onclick="navigateTo('fortune')">
                <div class="service-icon">üéÅ</div>
                <h3 class="service-title">Premi</h3>
                <p class="service-desc">Scopri le offerte del giorno</p>
            </div>
            
            <div class="service-card" onclick="openMaps()">
                <div class="service-icon">üìç</div>
                <h3 class="service-title">Dove Siamo</h3>
                <p class="service-desc">Indicazioni stradali</p>
            </div>
            
            <div class="service-card" onclick="openGoogleReviews()">
                <div class="service-icon">‚≠ê</div>
                <h3 class="service-title">Recensioni</h3>
                <p class="service-desc">4.8/5 su Google</p>
            </div>
            
            <div class="service-card" onclick="navigateTo('guide')">
                <div class="service-icon">üí°</div>
                <h3 class="service-title">Guide</h3>
                <p class="service-desc">Consigli per la vista</p>
            </div>
            
            <div class="service-card" onclick="navigateTo('negozio')">
                <div class="service-icon">üè™</div>
                <h3 class="service-title">Il Negozio</h3>
                <p class="service-desc">Orari e contatti</p>
            </div>
        </div>
    </div>

    <!-- PRENOTA PAGE -->
    <div id="prenota-page" class="page">
        <div class="hero">
            <div class="hero-content">
                <h1 class="hero-title">Prenota la tua visita</h1>
                <p class="hero-subtitle">Scegli il servizio pi√π adatto a te</p>
            </div>
        </div>

        <div class="services-grid" style="max-width: 600px; margin: 0 auto;">
            <div class="service-card" onclick="bookAppointment('Controllo Vista')">
                <div class="service-icon">üëÅÔ∏è</div>
                <h3 class="service-title">Controllo Vista</h3>
                <p class="service-desc">Esame completo della vista</p>
            </div>
            
            <div class="service-card" onclick="bookAppointment('Scelta Montature')">
                <div class="service-icon">üëì</div>
                <h3 class="service-title">Scelta Montature</h3>
                <p class="service-desc">Consulenza personalizzata</p>
            </div>
            
            <div class="service-card" onclick="bookAppointment('Lenti a Contatto')">
                <div class="service-icon">üëÅÔ∏è‚Äçüó®Ô∏è</div>
                <h3 class="service-title">Lenti a Contatto</h3>
                <p class="service-desc">Applicazione e training</p>
            </div>
            
            <div class="service-card" onclick="bookAppointment('Ritiro Occhiali')">
                <div class="service-icon">üì¶</div>
                <h3 class="service-title">Ritiro Occhiali</h3>
                <p class="service-desc">Ritira il tuo ordine</p>
            </div>
            
            <div class="service-card" onclick="bookAppointment('Assistenza')">
                <div class="service-icon">üîß</div>
                <h3 class="service-title">Assistenza</h3>
                <p class="service-desc">Riparazioni e regolazioni</p>
            </div>
            
            <div class="service-card" onclick="bookAppointment('Consulenza Sole')">
                <div class="service-icon">üï∂Ô∏è</div>
                <h3 class="service-title">Occhiali Sole</h3>
                <p class="service-desc">Protezione e stile</p>
            </div>
        </div>

        <div style="text-align: center; margin: 40px 20px;">
            <p style="color: var(--steel); margin-bottom: 20px;">Preferisci parlare con noi?</p>
            <div class="quick-actions">
                <a href="tel:+390245862417" class="quick-btn" onclick="trackPhoneClick('appointment_page')">üìû Chiama Ora</a>
            </div>
        </div>
    </div>

    <!-- CLUB &TE PAGE -->
    <div id="clubete-page" class="page">
        <div class="hero" style="background: linear-gradient(135deg, var(--midnight), #1a2c48); color: white;">
            <div class="hero-content">
                <h1 class="hero-title" style="color: white;">Club <span style="color: var(--champagne);">&Te</span></h1>
                <p class="hero-subtitle" style="color: rgba(255, 255, 255, 0.9);">Semplice, flessibile, senza pensieri</p>
                <div style="background: var(--champagne); color: var(--midnight); padding: 12px 24px; border-radius: 30px; display: inline-block; margin-top: 20px; font-weight: 600;">
                    Da solo 20‚Ç¨ al mese
                </div>
            </div>
        </div>

        <div style="background: white; padding: 30px 20px; margin: 20px; border-radius: 20px; box-shadow: 0 10px 40px var(--shadow);">
            <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; text-align: center; margin-bottom: 30px;">
                3 occhiali in 3 anni, <span style="color: var(--champagne);">quando vuoi tu</span>
            </h2>
            
            <div style="display: grid; gap: 20px; margin-bottom: 30px;">
                <div style="display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--silk); border-radius: 15px;">
                    <div style="font-size: 32px;">üéØ</div>
                    <div>
                        <h3 style="color: var(--midnight); margin-bottom: 4px;">Subito 2 occhiali!</h3>
                        <p style="color: var(--steel); font-size: 14px;">Puoi fare anche tutti e 3 gli occhiali insieme, subito al momento dell'iscrizione</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--silk); border-radius: 15px;">
                    <div style="font-size: 32px;">üí∞</div>
                    <div>
                        <h3 style="color: var(--midnight); margin-bottom: 4px;">Paghi a rate mensili</h3>
                        <p style="color: var(--steel); font-size: 14px;">Solo 20‚Ç¨/mese per lenti monofocali, 35‚Ç¨/mese per progressive</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--silk); border-radius: 15px;">
                    <div style="font-size: 32px;">üõ°Ô∏è</div>
                    <div>
                        <h3 style="color: var(--midnight); margin-bottom: 4px;">Garanzia Senza Pensieri</h3>
                        <p style="color: var(--steel); font-size: 14px;">Copertura 100% da rottura, furto, smarrimento o cambio gradazione</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--silk); border-radius: 15px;">
                    <div style="font-size: 32px;">üëì</div>
                    <div>
                        <h3 style="color: var(--midnight); margin-bottom: 4px;">Ampia scelta di brand</h3>
                        <p style="color: var(--steel); font-size: 14px;">Ray-Ban, Oakley, Prada, Versace e tanti altri marchi prestigiosi</p>
                    </div>
                </div>
            </div>

            <div style="text-align: center;">
                <a href="https://wa.me/390245862417?text=Vorrei%20informazioni%20sul%20Club%20%26Te" target="_blank" class="quick-btn" style="font-size: 16px; padding: 16px 32px;" onclick="trackWhatsAppClick('club_te_signup')">
                    üí¨ Iscriviti in Negozio
                </a>
            </div>
        </div>

        <!-- Altri contenuti Club &Te rimangono identici -->
        <!-- ... resto del contenuto Club &Te ... -->
    </div>

    <!-- FORTUNE WHEEL PAGE -->
    <div id="fortune-page" class="page">
        <div class="hero">
            <div class="hero-content">
                <h1 class="hero-title">Ruota dei <span style="color: var(--champagne);">Premi</span></h1>
                <p class="hero-subtitle">Tenta la fortuna per sconti esclusivi!</p>
            </div>
        </div>

        <div class="wheel-container">
            <div class="wheel-wrapper">
                <div class="wheel-pointer"></div>
                <div class="wheel" id="wheel">
                    <div class="wheel-prizes">
                        <div class="prize-text" style="top: 10%; left: 50%; transform: translateX(-50%) rotate(0deg);">20% SOLE</div>
                        <div class="prize-text" style="top: 25%; right: 15%; transform: rotate(60deg);">50% LENTI</div>
                        <div class="prize-text" style="bottom: 25%; right: 15%; transform: rotate(120deg);">‚Ç¨50 VISTA</div>
                        <div class="prize-text" style="bottom: 10%; left: 50%; transform: translateX(-50%) rotate(180deg);">RIPROVA</div>
                        <div class="prize-text" style="bottom: 25%; left: 15%; transform: rotate(240deg);">50% VISTA</div>
                        <div class="prize-text" style="top: 25%; left: 15%; transform: rotate(300deg);">RIPROVA</div>
                    </div>
                    <div class="wheel-center">S&V</div>
                </div>
            </div>
            <button class="spin-button" onclick="spinWheel()">GIRA LA RUOTA</button>
        </div>

        <div style="text-align: center; padding: 0 20px; color: var(--steel); font-size: 14px; margin-bottom: 40px;">
            <p>üéØ Un tentativo al giorno</p>
            <p>üéÅ Mostra il codice in negozio</p>
            <p>‚è∞ Valido per 7 giorni</p>
        </div>

        <!-- QR Code Generator Section -->
        <div style="background: white; margin: 20px; border-radius: 20px; padding: 30px; box-shadow: 0 10px 40px var(--shadow);">
            <h2 style="font-family: 'Playfair Display', serif; text-align: center; margin-bottom: 20px; color: var(--midnight);">
                üéÆ Sfida i tuoi amici!
            </h2>
            <p style="text-align: center; color: var(--steel); margin-bottom: 30px;">
                Genera un QR code per far giocare chi conosci alla ruota dei premi
            </p>
            
            <div id="qr-generator" style="text-align: center;">
                <button class="quick-btn" onclick="generateQRCode()" style="margin-bottom: 30px;">
                    üì± Genera QR Code
                </button>
                
                <div id="qr-container" style="display: none;">
                    <div style="background: var(--silk); padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                        <div id="qr-canvas" style="margin: 0 auto; display: block;"></div>
                    </div>
                    
                    <p style="color: var(--steel); font-size: 14px; margin-bottom: 20px;">
                        üì≤ Mostra questo QR ai tuoi amici per farli giocare
                    </p>
                    
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="quick-btn secondary" onclick="downloadQR()">
                            üíæ Scarica QR
                        </button>
                        <button class="quick-btn secondary" onclick="shareQR()">
                            üì§ Condividi
                        </button>
                        <button class="quick-btn secondary" onclick="copyLink()">
                            üîó Copia Link
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, rgba(212, 175, 55, 0.05), rgba(212, 175, 55, 0.1)); border-radius: 10px; border-left: 3px solid var(--champagne);">
                        <p style="font-size: 13px; color: var(--steel); margin: 0;">
                            üí° <strong>Suggerimento:</strong> Stampalo e mettilo in vista per far giocare i clienti in negozio!
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- GUIDE PAGE -->
    <div id="guide-page" class="page">
        <div class="hero">
            <div class="hero-content">
                <h1 class="hero-title">Guide Esclusive</h1>
                <p class="hero-subtitle">Consigli professionali per la tua vista</p>
            </div>
        </div>

        <div class="guides-container">
            <div class="guide-card" onclick="toggleGuide(this)">
                <div class="guide-header">
                    <h3 class="guide-title">Come Pulire le Lenti</h3>
                    <span class="guide-icon">+</span>
                </div>
                <div class="guide-content">
                    <p class="guide-text">La pulizia corretta delle lenti √® essenziale per mantenere una visione nitida e prolungare la vita dei tuoi occhiali.</p>
                    <div class="guide-tip">
                        <div class="guide-tip-title">üí° Procedura Corretta:</div>
                        <ol style="margin-left: 20px; color: var(--steel);">
                            <li>Sciacqua con acqua tiepida</li>
                            <li>Applica una goccia di sapone neutro</li>
                            <li>Strofina delicatamente con i polpastrelli</li>
                            <li>Risciacqua abbondantemente</li>
                            <li>Asciuga con panno in microfibra</li>
                        </ol>
                    </div>
                    <p class="guide-text" style="margin-top: 16px;">‚ö†Ô∏è <strong>Evita:</strong> tessuti ruvidi, carta, alcool, acetone</p>
                </div>
            </div>

            <div class="guide-card" onclick="toggleGuide(this)">
                <div class="guide-header">
                    <h3 class="guide-title">Scegliere la Montatura Giusta</h3>
                    <span class="guide-icon">+</span>
                </div>
                <div class="guide-content">
                    <p class="guide-text">La montatura perfetta valorizza il tuo viso e riflette la tua personalit√†.</p>
                    <div class="guide-tip">
                        <div class="guide-tip-title">üë§ Per Forma del Viso:</div>
                        <ul style="margin-left: 20px; color: var(--steel);">
                            <li><strong>Ovale:</strong> Quasi tutte le forme</li>
                            <li><strong>Rotondo:</strong> Montature squadrate o rettangolari</li>
                            <li><strong>Quadrato:</strong> Forme tonde o ovali</li>
                            <li><strong>Triangolare:</strong> Cat-eye o montature larghe in alto</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="guide-card" onclick="toggleGuide(this)">
                <div class="guide-header">
                    <h3 class="guide-title">Protezione UV</h3>
                    <span class="guide-icon">+</span>
                </div>
                <div class="guide-content">
                    <p class="guide-text">La protezione dai raggi UV √® fondamentale per la salute dei tuoi occhi.</p>
                    <div class="guide-tip">
                        <div class="guide-tip-title">üï∂Ô∏è Cosa Cercare:</div>
                        <ul style="margin-left: 20px; color: var(--steel);">
                            <li>Protezione UV400 (blocca il 100% dei raggi UV)</li>
                            <li>Lenti polarizzate per ridurre i riflessi</li>
                            <li>Categoria 3 per sole intenso</li>
                            <li>Marchio CE per conformit√† europea</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="guide-card" onclick="toggleGuide(this)">
                <div class="guide-header">
                    <h3 class="guide-title">Manutenzione Occhiali</h3>
                    <span class="guide-icon">+</span>
                </div>
                <div class="guide-content">
                    <p class="guide-text">Una corretta manutenzione garantisce comfort e durata nel tempo.</p>
                    <div class="guide-tip">
                        <div class="guide-tip-title">üîß Controlli Periodici:</div>
                        <ul style="margin-left: 20px; color: var(--steel);">
                            <li>Viti delle cerniere: stringere ogni 2 mesi</li>
                            <li>Naselli: pulire settimanalmente</li>
                            <li>Astine: verificare l'allineamento</li>
                            <li>Controllo professionale: ogni 6 mesi</li>
                        </ul>
                    </div>
                    <p class="guide-text" style="margin-top: 16px;">Passa in negozio per un controllo gratuito!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- NEGOZIO PAGE -->
    <div id="negozio-page" class="page">
        <div class="hero">
            <div class="hero-content">
                <h1 class="hero-title">Il Nostro Negozio</h1>
                <p class="hero-subtitle">Esperienza e professionalit√† dal 1865</p>
            </div>
        </div>

        <div class="store-info">
            <h2>Informazioni & Contatti</h2>
            
            <div class="info-row">
                <div class="info-icon">üìç</div>
                <div class="info-text">
                    <div class="info-label">Indirizzo</div>
                    <div class="info-value">
                        <a href="https://maps.app.goo.gl/ukcJy7yEZZPEuH4v6" target="_blank" onclick="trackMapsClick('store_info')">
                            Via Don Sturzo<br>
                            CC Le Porte di Milano<br>
                            20090 Cesano Boscone (MI)
                        </a>
                    </div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">üìû</div>
                <div class="info-text">
                    <div class="info-label">Telefono</div>
                    <div class="info-value">
                        <a href="tel:+390245862417" onclick="trackPhoneClick('store_info')">02 4586 2417</a>
                    </div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">üí¨</div>
                <div class="info-text">
                    <div class="info-label">WhatsApp Business</div>
                    <div class="info-value">
                        <a href="https://wa.me/390245862417?text=Salve,%20vorrei%20informazioni" target="_blank" onclick="trackWhatsAppClick('store_info')">
                            Chat con noi
                        </a>
                    </div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">‚úâÔ∏è</div>
                <div class="info-text">
                    <div class="info-label">Email</div>
                    <div class="info-value">
                        <a href="mailto:mi835@luxottica.com" onclick="trackEmailClick('store_info')">Invia email</a>
                    </div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">üïê</div>
                <div class="info-text">
                    <div class="info-label">Orari</div>
                    <div class="info-value">
                        Lun-Sab: 9:00 - 20:00<br>
                        Domenica: 10:00 - 20:00
                    </div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">‚≠ê</div>
                <div class="info-text">
                    <div class="info-label">Recensioni Google</div>
                    <div class="info-value">
                        <a href="https://g.page/r/CYXFRNPfaJnwEBM/review" target="_blank" onclick="trackReviewClick('store_info')">
                            4.8/5 ‚≠ê Leggi le recensioni
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="reviews-section">
            <h2 style="font-family: 'Playfair Display', serif; text-align: center; margin-bottom: 30px;">Cosa dicono i nostri clienti</h2>
            
            <div class="review-card">
                <div class="review-header">
                    <span class="review-author">Maria R.</span>
                    <span class="review-rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                </div>
                <p class="review-text">"Servizio impeccabile! Il personale √® estremamente competente e mi ha aiutato a scegliere la montatura perfetta. Torner√≤ sicuramente."</p>
                <span class="review-date">2 settimane fa</span>
            </div>

            <div class="review-card">
                <div class="review-header">
                    <span class="review-author">Giuseppe L.</span>
                    <span class="review-rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                </div>
                <p class="review-text">"Professionalit√† e cortesia. Ho trovato esattamente quello che cercavo e i prezzi sono molto competitivi."</p>
                <span class="review-date">1 mese fa</span>
            </div>

            <div class="review-card">
                <div class="review-header">
                    <span class="review-author">Francesca M.</span>
                    <span class="review-rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                </div>
                <p class="review-text">"Ottima esperienza! Personale qualificato e grande assortimento di montature di marca."</p>
                <span class="review-date">1 mese fa</span>
            </div>

            <a href="https://g.page/r/CYXFRNPfaJnwEBM/review" target="_blank" class="review-cta" onclick="trackReviewClick('review_cta')">
                ‚úçÔ∏è Lascia la tua recensione
            </a>
        </div>
    </div>

    <!-- Cookie Banner -->
    <div class="cookie-banner" id="cookie-banner">
        <div class="cookie-content">
            <h3 class="cookie-title">üç™ Rispettiamo la tua privacy</h3>
            <p class="cookie-text">
                Utilizziamo cookie essenziali per il funzionamento del sito e, solo con il tuo consenso, 
                cookie analitici per migliorare i nostri servizi. Nessun dato personale viene condiviso con terze parti.
            </p>
            <div class="cookie-buttons">
                <button class="cookie-btn accept" onclick="acceptCookies()">‚úÖ Accetta tutto</button>
                <button class="cookie-btn customize" onclick="showPrivacySettings()">‚öôÔ∏è Personalizza</button>
                <button class="cookie-btn reject" onclick="rejectCookies()">‚ùå Solo essenziali</button>
            </div>
        </div>
    </div>

    <!-- Privacy Settings Modal -->
    <div class="modal privacy-modal" id="privacy-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closePrivacyModal()">‚úï</button>
            <h2 style="font-family: 'Playfair Display', serif; text-align: center; margin-bottom: 30px;">‚öôÔ∏è Impostazioni Privacy</h2>
            
            <div class="privacy-section">
                <h3>üîí Cookie Essenziali</h3>
                <p>Necessari per il funzionamento base del sito (navigazione, sicurezza). Sempre attivi.</p>
                <div class="consent-toggle">
                    <div class="toggle-info">
                        <div class="toggle-title">Cookie Tecnici</div>
                        <div class="toggle-desc">Funzionalit√† base del sito</div>
                    </div>
                    <div class="toggle-switch">
                        <input type="checkbox" checked disabled>
                        <span class="toggle-slider"></span>
                    </div>
                </div>
            </div>
            
            <div class="privacy-section">
                <h3>üìä Cookie Analitici</h3>
                <p>Ci aiutano a capire come viene utilizzato il sito per migliorare i nostri servizi. Tutti i dati sono anonimi.</p>
                <div class="consent-toggle">
                    <div class="toggle-info">
                        <div class="toggle-title">Google Analytics</div>
                        <div class="toggle-desc">Statistiche anonime di utilizzo (IP anonimizzato)</div>
                    </div>
                    <div class="toggle-switch">
                        <input type="checkbox" id="analytics-toggle">
                        <span class="toggle-slider"></span>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="quick-btn" onclick="savePrivacySettings()" style="margin-right: 10px;">üíæ Salva Preferenze</button>
                <button class="quick-btn secondary" onclick="closePrivacyModal()">‚ùå Annulla</button>
            </div>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--smoke); font-size: 12px; color: var(--steel); text-align: center;">
                üìß <strong>Domande?</strong> Contattaci: <a href="mailto:mi835@luxottica.com" style="color: var(--champagne);" onclick="trackEmailClick('privacy_modal')">mi835@luxottica.com</a><br>
                üìÑ Per maggiori informazioni consulta la <a href="#" onclick="showPrivacyPolicy()" style="color: var(--champagne);">Privacy Policy</a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-brand">Salmoiraghi & Vigan√≤</div>
            <p class="footer-text">
                L'eccellenza della vista dal 1865<br>
                La tua boutique di fiducia
            </p>
            <p class="footer-text">
                <a href="https://maps.app.goo.gl/ukcJy7yEZZPEuH4v6" target="_blank" class="footer-link" onclick="trackMapsClick('footer')">
                    üìç Vieni a trovarci
                </a>
            </p>
        </div>
    </footer>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#home" class="nav-item active" onclick="navigateTo('home'); return false;">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">Home</span>
        </a>
        <a href="#prenota" class="nav-item" onclick="navigateTo('prenota'); return false;">
            <span class="nav-icon">üìÖ</span>
            <span class="nav-label">Prenota</span>
        </a>
        <a href="#fortune" class="nav-item" onclick="navigateTo('fortune'); return false;">
            <span class="nav-icon">üéÅ</span>
            <span class="nav-label">Premi</span>
        </a>
        <a href="#guide" class="nav-item" onclick="navigateTo('guide'); return false;">
            <span class="nav-icon">üí°</span>
            <span class="nav-label">Guide</span>
        </a>
        <a href="#negozio" class="nav-item" onclick="navigateTo('negozio'); return false;">
            <span class="nav-icon">üè™</span>
            <span class="nav-label">Info</span>
        </a>
    </nav>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">‚úï</button>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- Install Prompt -->
    <div class="install-prompt" id="install-prompt">
        <div class="install-content">
            <div class="install-text">
                <div class="install-title">Installa S&V App</div>
                <div class="install-desc">Accesso rapido alla tua boutique</div>
            </div>
            <div class="install-buttons">
                <button class="install-button primary" onclick="installApp()">Installa</button>
                <button class="install-button secondary" onclick="hideInstallPrompt()">Dopo</button>
            </div>
        </div>
    </div>

    <script>
        // ===== SISTEMA DI LOGGING AVANZATO =====
        const Logger = {
            log: function(message, data = {}) {
                console.log(`%c[S&V App] ${message}`, 'color: #d4af37; font-weight: bold;', data);
            },
            error: function(message, error = {}) {
                console.error(`%c[S&V Error] ${message}`, 'color: #e0115f; font-weight: bold;', error);
            },
            track: function(event, data = {}) {
                console.log(`%c[S&V Track] ${event}`, 'color: #50c878; font-weight: bold;', data);
            }
        };

        // ===== GESTIONE PRELOADER - FIXED =====
        let preloaderHidden = false;
        
        function hidePreloader() {
            if (preloaderHidden) return;
            preloaderHidden = true;
            
            const preloader = document.getElementById('preloader');
            if (preloader) {
                Logger.log('Nascondendo preloader...');
                preloader.classList.add('hidden');
                
                // Rimozione sicura dopo transizione
                setTimeout(() => {
                    if (preloader && preloader.parentNode) {
                        preloader.style.display = 'none';
                    }
                    Logger.log('Preloader rimosso completamente');
                }, 600);
            }
        }

        // Nascondere preloader - Multiple triggers per sicurezza
        document.addEventListener('DOMContentLoaded', () => {
            Logger.log('DOM caricato');
            setTimeout(hidePreloader, 500);
        });

        window.addEventListener('load', () => {
            Logger.log('Window caricata');
            setTimeout(hidePreloader, 200);
        });

        // Fallback assoluto
        setTimeout(hidePreloader, 2000);

        // ===== ANALYTICS & PRIVACY MANAGEMENT =====
        let analyticsEnabled = false;
        
        function initPrivacy() {
            Logger.log('Inizializzazione privacy...');
            const consent = localStorage.getItem('cookie-consent');
            if (consent) {
                try {
                    const settings = JSON.parse(consent);
                    analyticsEnabled = settings.analytics;
                    Logger.log('Consenso esistente trovato', settings);
                    if (analyticsEnabled) {
                        enableAnalytics();
                    }
                } catch (e) {
                    Logger.error('Errore parsing consenso', e);
                }
            } else {
                setTimeout(() => {
                    Logger.log('Mostrando banner cookie');
                    const banner = document.getElementById('cookie-banner');
                    if (banner) banner.classList.add('show');
                }, 2000);
            }
        }
        
        function enableAnalytics() {
            Logger.log('Abilitando Google Analytics...');
            if (typeof gtag !== 'undefined') {
                gtag('consent', 'update', {
                    'analytics_storage': 'granted'
                });
                analyticsEnabled = true;
                Logger.log('Analytics abilitato');
            }
        }
        
        function disableAnalytics() {
            Logger.log('Disabilitando Google Analytics...');
            if (typeof gtag !== 'undefined') {
                gtag('consent', 'update', {
                    'analytics_storage': 'denied'
                });
                analyticsEnabled = false;
                Logger.log('Analytics disabilitato');
            }
        }
        
        // ===== COOKIE BANNER FUNCTIONS =====
        function acceptCookies() {
            const settings = { essential: true, analytics: true };
            localStorage.setItem('cookie-consent', JSON.stringify(settings));
            enableAnalytics();
            document.getElementById('cookie-banner').classList.remove('show');
            Logger.log('Cookie accettati', settings);
        }
        
        function rejectCookies() {
            const settings = { essential: true, analytics: false };
            localStorage.setItem('cookie-consent', JSON.stringify(settings));
            disableAnalytics();
            document.getElementById('cookie-banner').classList.remove('show');
            Logger.log('Cookie rifiutati', settings);
        }
        
        function showPrivacySettings() {
            document.getElementById('cookie-banner').classList.remove('show');
            const consent = localStorage.getItem('cookie-consent');
            if (consent) {
                const settings = JSON.parse(consent);
                document.getElementById('analytics-toggle').checked = settings.analytics;
            }
            document.getElementById('privacy-modal').classList.add('active');
        }
        
        function closePrivacyModal() {
            document.getElementById('privacy-modal').classList.remove('active');
            if (!localStorage.getItem('cookie-consent')) {
                setTimeout(() => {
                    document.getElementById('cookie-banner').classList.add('show');
                }, 500);
            }
        }
        
        function savePrivacySettings() {
            const analytics = document.getElementById('analytics-toggle').checked;
            const settings = { essential: true, analytics };
            
            localStorage.setItem('cookie-consent', JSON.stringify(settings));
            
            if (analytics) {
                enableAnalytics();
            } else {
                disableAnalytics();
            }
            
            document.getElementById('privacy-modal').classList.remove('active');
            Logger.log('Impostazioni privacy salvate', settings);
        }
        
        function showPrivacyPolicy() {
            const policyContent = `
                <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 20px;">üìÑ Informativa Privacy</h2>
                <div style="text-align: left; max-height: 400px; overflow-y: auto; padding-right: 10px;">
                    <h3>üç™ Cookie utilizzati</h3>
                    <p><strong>Cookie Essenziali:</strong> Necessari per il funzionamento del sito (sessione, sicurezza, preferenze).</p>
                    <p><strong>Google Analytics:</strong> Raccoglie dati anonimi sull'utilizzo del sito (con IP anonimizzato).</p>
                    
                    <h3>üìä Dati raccolti</h3>
                    <p>‚Ä¢ Pagine visitate e tempo di permanenza<br>
                    ‚Ä¢ Dispositivo utilizzato (mobile/desktop)<br>
                    ‚Ä¢ Azioni specifiche: scansioni QR, contatti WhatsApp<br>
                    ‚Ä¢ Nessun dato personale identificabile</p>
                    
                    <h3>üéØ Finalit√†</h3>
                    <p>I dati servono esclusivamente per migliorare l'esperienza utente e ottimizzare i servizi della boutique.</p>
                    
                    <h3>üìß Contatti</h3>
                    <p>Per domande sulla privacy: <a href="mailto:mi835@luxottica.com" style="color: var(--champagne);" onclick="trackEmailClick('privacy_policy')">mi835@luxottica.com</a></p>
                </div>
            `;
            showModal('', '', policyContent + '<button class="quick-btn" onclick="closeModal()" style="margin-top: 20px; width: 100%;">Chiudi</button>');
        }

        // ===== ENHANCED EVENT TRACKING =====
        function trackEvent(eventName, eventData = {}) {
            Logger.track(eventName, eventData);
            
            if (analyticsEnabled && typeof gtag !== 'undefined') {
                try {
                    gtag('event', eventName, {
                        'event_category': eventData.category || 'engagement',
                        'event_label': eventData.label || '',
                        'value': eventData.value || 1,
                        'custom_parameter': eventData,
                        'send_to': 'G-LX1EQS2ESC'
                    });
                    Logger.log('Evento GA inviato', { eventName, eventData });
                } catch (e) {
                    Logger.error('Errore invio evento GA', e);
                }
            }
        }
        
        // ===== CONTACT TRACKING FUNCTIONS =====
        function trackPhoneClick(source = 'generic') {
            trackEvent('phone_click', {
                category: 'conversion',
                label: source,
                source: source,
                phone_number: '+390245862417'
            });
        }
        
        function trackWhatsAppClick(source = 'generic') {
            trackEvent('whatsapp_click', {
                category: 'conversion', 
                label: source,
                source: source,
                whatsapp_number: '390245862417'
            });
        }
        
        function trackEmailClick(source = 'generic') {
            trackEvent('email_click', {
                category: 'conversion',
                label: source,
                source: source,
                email: 'mi835@luxottica.com'
            });
        }
        
        function trackMapsClick(source = 'generic') {
            trackEvent('maps_click', {
                category: 'engagement',
                label: source,
                source: source,
                maps_url: 'https://maps.app.goo.gl/ukcJy7yEZZPEuH4v6'
            });
        }
        
        function trackReviewClick(source = 'generic') {
            trackEvent('review_click', {
                category: 'engagement',
                label: source,
                source: source,
                review_url: 'https://g.page/r/CYXFRNPfaJnwEBM/review'
            });
        }

        function trackQRScan() {
            trackEvent('qr_scan', {
                category: 'engagement',
                label: 'qr_code_scan',
                value: 1
            });
        }

        // ===== PAGE NAVIGATION =====
        const pages = {
            'home': 'home-page',
            'prenota': 'prenota-page', 
            'clubete': 'clubete-page',
            'fortune': 'fortune-page',
            'guide': 'guide-page',
            'negozio': 'negozio-page'
        };

        function navigateTo(pageName) {
            Logger.log('Navigazione verso:', pageName);
            
            // Track page view
            trackEvent('page_view', {
                category: 'navigation',
                label: pageName,
                page: pageName
            });
            
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            const pageId = pages[pageName];
            if (pageId) {
                document.getElementById(pageId).classList.add('active');
            }
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + pageName) {
                    item.classList.add('active');
                }
            });
            
            window.scrollTo(0, 0);
        }

        // ===== EXTERNAL LINKS FUNCTIONS =====
        function openMaps() {
            trackMapsClick('service_card');
            window.open('https://maps.app.goo.gl/ukcJy7yEZZPEuH4v6', '_blank');
        }
        
        function openGoogleReviews() {
            trackReviewClick('service_card');
            window.open('https://g.page/r/CYXFRNPfaJnwEBM/review', '_blank');
        }

        // ===== COUNTDOWN TIMER =====
        function updateTimer() {
            const endTime = new Date();
            endTime.setHours(23, 59, 59, 999);
            
            const now = new Date();
            const diff = endTime - now;
            
            if (diff <= 0) {
                endTime.setDate(endTime.getDate() + 1);
                endTime.setHours(23, 59, 59, 999);
                diff = endTime - now;
            }
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            const hoursEl = document.getElementById('timer-hours');
            const minutesEl = document.getElementById('timer-minutes');
            const secondsEl = document.getElementById('timer-seconds');
            
            if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
            if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
            if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
        }
        
        setInterval(updateTimer, 1000);
        updateTimer();

        // ===== APPOINTMENT BOOKING =====
        function bookAppointment(service) {
            trackWhatsAppClick('appointment_' + service.toLowerCase().replace(/\s+/g, '_'));
            const message = `Salve, vorrei prenotare: ${service}`;
            const phoneNumber = '390245862417';
            const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            
            // Additional tracking for appointment type
            trackEvent('appointment_request', {
                category: 'conversion',
                label: service,
                service_type: service
            });
            
            window.open(url, '_blank');
        }

        // ===== GUIDE TOGGLE =====
        function toggleGuide(card) {
            const content = card.querySelector('.guide-content');
            const icon = card.querySelector('.guide-icon');
            const title = card.querySelector('.guide-title').textContent;
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                icon.textContent = '+';
                
                trackEvent('guide_closed', {
                    category: 'engagement',
                    label: title,
                    guide_title: title
                });
            } else {
                document.querySelectorAll('.guide-content').forEach(c => {
                    c.classList.remove('active');
                });
                document.querySelectorAll('.guide-icon').forEach(i => {
                    i.textContent = '+';
                });
                
                content.classList.add('active');
                icon.textContent = '‚àí';
                
                trackEvent('guide_opened', {
                    category: 'engagement',
                    label: title,
                    guide_title: title
                });
            }
        }

        // ===== FORTUNE WHEEL - ENHANCED =====
        let isSpinning = false;
        let lastSpinDate = localStorage.getItem('lastSpinDate');
        let currentRotation = 0;
        
        function canSpin() {
            const today = new Date().toDateString();
            return lastSpinDate !== today;
        }

        function spinWheel() {
            if (isSpinning) return;
            
            if (!canSpin()) {
                showModal('‚è∞', 'Torna domani!', 'Hai gi√† girato la ruota oggi. Ritorna domani per un nuovo tentativo!');
                trackEvent('wheel_daily_limit_reached', {
                    category: 'engagement',
                    label: 'daily_limit'
                });
                return;
            }
            
            isSpinning = true;
            const wheel = document.getElementById('wheel');
            const spinButton = document.querySelector('.spin-button');
            
            spinButton.disabled = true;
            spinButton.textContent = 'GIRANDO...';
            
            Logger.log('Ruota in movimento...');
            
            const prizes = [
                { name: '20% occhiale da sole', angle: 0, weight: 40 },
                { name: '50% lenti a contatto', angle: 60, weight: 25 },
                { name: '‚Ç¨50 extra sconto vista', angle: 120, weight: 20 },
                { name: 'Riprova domani!', angle: 180, weight: 5 },
                { name: '50% occhiale da vista', angle: 240, weight: 8 },
                { name: 'Riprova domani!', angle: 300, weight: 2 }
            ];
            
            const totalWeight = prizes.reduce((sum, prize) => sum + prize.weight, 0);
            let random = Math.random() * totalWeight;
            let selectedPrize = prizes[0];
            
            for (let prize of prizes) {
                random -= prize.weight;
                if (random <= 0) {
                    selectedPrize = prize;
                    break;
                }
            }
            
            const spins = 5 + Math.random() * 3;
            const finalAngle = 360 - selectedPrize.angle + (Math.random() * 40 - 20);
            const totalRotation = currentRotation + (spins * 360) + finalAngle;
            
            wheel.style.transform = `rotate(${totalRotation}deg)`;
            currentRotation = totalRotation % 360;
            
            setTimeout(() => {
                const isWin = !selectedPrize.name.includes('Riprova');
                const code = isWin ? 'SV' + Date.now().toString().slice(-6) : null;
                
                Logger.log('Risultato ruota:', { selectedPrize, isWin, code });
                
                if (isWin) {
                    showModal(
                        'üéâ',
                        'Congratulazioni!',
                        `<p style="font-size: 20px; margin: 20px 0;">Hai vinto:<br><strong>${selectedPrize.name}</strong></p>
                        <div style="background: var(--silk); padding: 20px; border-radius: 15px; margin: 20px 0;">
                            <p style="font-family: monospace; font-size: 24px; letter-spacing: 3px; color: var(--midnight);">${code}</p>
                        </div>
                        <p style="color: var(--steel); font-size: 14px;">Mostra questo codice in negozio<br>Valido per 7 giorni</p>
                        <a href="https://wa.me/390245862417?text=Ho%20vinto%20il%20codice%20${code}%20per%20${encodeURIComponent(selectedPrize.name)}" target="_blank" class="quick-btn" style="margin-top: 20px;" onclick="trackWhatsAppClick('wheel_winner')">üí¨ Invia su WhatsApp</a>`
                    );
                } else {
                    showModal(
                        'üòî',
                        'Riprova domani!',
                        `<p style="font-size: 18px; margin: 20px 0;">Non hai vinto questa volta, ma non arrenderti!</p>
                        <p style="color: var(--steel); font-size: 14px;">Torna domani per un nuovo tentativo gratuito</p>
                        <div style="margin-top: 20px; padding: 15px; background: var(--silk); border-radius: 10px;">
                            <p style="font-size: 14px; color: var(--midnight);">üí° <strong>Intanto scopri:</strong><br>
                            ‚Ä¢ Il Club &Te da 20‚Ç¨/mese<br>
                            ‚Ä¢ Le nostre offerte in negozio</p>
                        </div>`
                    );
                }
                
                localStorage.setItem('lastSpinDate', new Date().toDateString());
                
                spinButton.disabled = false;
                spinButton.textContent = 'GIRA LA RUOTA';
                isSpinning = false;
                
                trackEvent('wheel_spin', {
                    category: 'engagement',
                    label: selectedPrize.name,
                    result: selectedPrize.name,
                    is_winner: isWin,
                    code: code || 'none'
                });
                
            }, 4000);
        }

        // ===== QR CODE FUNCTIONS - ENHANCED =====
        let qrCode = null;
        const APP_URL = window.location.origin + window.location.pathname;
        
        function generateQRCode() {
            const container = document.getElementById('qr-container');
            const canvas = document.getElementById('qr-canvas');
            
            canvas.innerHTML = '';
            
            const gameUrl = APP_URL + '?game=wheel&ref=qr';
            Logger.log('Generando QR Code per URL:', gameUrl);
            
            try {
                if (typeof QRCode !== 'undefined') {
                    qrCode = new QRCode(canvas, {
                        text: gameUrl,
                        width: 200,
                        height: 200,
                        colorDark: '#0a1628',
                        colorLight: '#ffffff',
                        correctLevel: QRCode.CorrectLevel.M
                    });
                    Logger.log('QR Code generato con QRCode.js');
                } else {
                    const qrImg = document.createElement('img');
                    qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(gameUrl)}`;
                    qrImg.style.borderRadius = '10px';
                    qrImg.alt = 'QR Code per S&V Ruota dei Premi';
                    qrImg.style.maxWidth = '100%';
                    canvas.appendChild(qrImg);
                    Logger.log('QR Code generato con servizio web');
                }
                
                container.style.display = 'block';
                
                trackEvent('qr_generated', {
                    category: 'engagement',
                    label: 'wheel_game',
                    source: 'wheel_game',
                    url: gameUrl
                });
                
            } catch (e) {
                Logger.error('Errore generazione QR Code', e);
                showModal('‚ùå', 'Errore', 'Impossibile generare il QR Code. Riprova pi√π tardi.');
            }
        }
        
        function downloadQR() {
            try {
                const canvas = document.querySelector('#qr-canvas canvas');
                const img = document.querySelector('#qr-canvas img');
                
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = 'SV-Ruota-QR.png';
                    link.href = canvas.toDataURL();
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    Logger.log('QR Code scaricato (canvas)');
                } else if (img) {
                    const link = document.createElement('a');
                    link.download = 'SV-Ruota-QR.png';
                    link.href = img.src;
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    Logger.log('QR Code scaricato (img)');
                }
                
                trackEvent('qr_downloaded', { 
                    category: 'engagement',
                    label: 'wheel_game',
                    source: 'wheel_game' 
                });
                
            } catch (e) {
                Logger.error('Errore download QR', e);
                showModal('‚ùå', 'Errore', 'Impossibile scaricare il QR Code.');
            }
        }
        
        function shareQR() {
            const gameUrl = APP_URL + '?game=wheel&ref=qr';
            
            if (navigator.share) {
                navigator.share({
                    title: 'üéÆ Gioca alla Ruota S&V!',
                    text: 'Prova a vincere sconti esclusivi girando la ruota di Salmoiraghi & Vigan√≤!',
                    url: gameUrl
                }).then(() => {
                    trackEvent('qr_shared', { 
                        category: 'engagement',
                        label: 'native_share',
                        method: 'native', 
                        source: 'wheel_game' 
                    });
                    Logger.log('QR condiviso tramite API nativa');
                }).catch((e) => {
                    Logger.error('Errore condivisione nativa', e);
                });
            } else {
                const message = `üéÆ Gioca alla Ruota S&V e vinci sconti esclusivi! ${gameUrl}`;
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
                trackEvent('qr_shared', { 
                    category: 'engagement',
                    label: 'whatsapp_fallback',
                    method: 'whatsapp', 
                    source: 'wheel_game' 
                });
                Logger.log('QR condiviso tramite WhatsApp fallback');
            }
        }
        
        function copyLink() {
            const gameUrl = APP_URL + '?game=wheel&ref=qr';
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(gameUrl).then(() => {
                    showModal('‚úÖ', 'Link copiato!', 'Il link √® stato copiato negli appunti. Condividilo con chi vuoi!');
                    trackEvent('qr_link_copied', { 
                        category: 'engagement',
                        label: 'clipboard_api',
                        source: 'wheel_game' 
                    });
                    Logger.log('Link copiato tramite Clipboard API');
                }).catch((e) => {
                    Logger.error('Errore copia clipboard', e);
                    fallbackCopyLink(gameUrl);
                });
            } else {
                fallbackCopyLink(gameUrl);
            }
        }
        
        function fallbackCopyLink(gameUrl) {
            try {
                const textArea = document.createElement('textarea');
                textArea.value = gameUrl;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                showModal('‚úÖ', 'Link copiato!', 'Il link √® stato copiato negli appunti. Condividilo con chi vuoi!');
                trackEvent('qr_link_copied', { 
                    category: 'engagement',
                    label: 'fallback_method',
                    source: 'wheel_game' 
                });
                Logger.log('Link copiato tramite fallback');
            } catch (e) {
                Logger.error('Errore copia fallback', e);
                showModal('‚ùå', 'Errore', 'Impossibile copiare il link. Condividi manualmente: ' + gameUrl);
            }
        }

        // ===== MODAL FUNCTIONS =====
        function showModal(emoji, title, content) {
            const modalBody = document.getElementById('modal-body');
            modalBody.innerHTML = `
                <div style="text-align: center;">
                    ${emoji ? `<div style="font-size: 60px; margin-bottom: 20px;">${emoji}</div>` : ''}
                    ${title ? `<h2 style="font-family: 'Playfair Display', serif; font-size: 32px; color: var(--midnight); margin-bottom: 20px;">${title}</h2>` : ''}
                    ${content}
                </div>
            `;
            document.getElementById('modal').classList.add('active');
            
            // Track modal open
            trackEvent('modal_opened', {
                category: 'engagement',
                label: title || 'unknown',
                modal_title: title || 'unknown'
            });
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // ===== PWA INSTALL - ENHANCED =====
        let deferredPrompt;
        let isFirstVisit = !localStorage.getItem('hasVisited');
        
        function isAppInstalled() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }
        
        function showInstallInstructions() {
            const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let instructions = '';
            
            if (isIOS) {
                instructions = `
                    <div style="text-align: center;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üì±</div>
                        <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 20px;">Installa S&V sul tuo iPhone</h2>
                        <div style="text-align: left; max-width: 300px; margin: 0 auto;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">1</div>
                                <p>Tocca il pulsante Condividi <span style="color: var(--sapphire);">‚Üó</span> in basso</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">2</div>
                                <p>Scorri e tocca "Aggiungi alla schermata Home" ‚ûï</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">3</div>
                                <p>Tocca "Aggiungi" in alto a destra</p>
                            </div>
                        </div>
                        <p style="color: var(--steel); font-size: 14px; margin-top: 20px;">L'icona S&V apparir√† sul tuo schermo!</p>
                    </div>
                `;
            } else if (isAndroid) {
                instructions = `
                    <div style="text-align: center;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üì±</div>
                        <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 20px;">Installa S&V sul tuo Android</h2>
                        <p style="color: var(--steel); margin-bottom: 30px;">Tocca "Installa" quando appare il messaggio in basso, oppure:</p>
                        <div style="text-align: left; max-width: 300px; margin: 0 auto;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">1</div>
                                <p>Tocca i 3 puntini ‚ãÆ in alto a destra</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">2</div>
                                <p>Seleziona "Aggiungi a schermata Home"</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">3</div>
                                <p>Conferma toccando "Aggiungi"</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                instructions = `
                    <div style="text-align: center;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üíª</div>
                        <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 20px;">Salva S&V Boutique</h2>
                        <p style="color: var(--steel);">Aggiungi questa pagina ai preferiti per accesso rapido</p>
                        <p style="margin-top: 20px;">Premi <strong>Ctrl+D</strong> (Windows) o <strong>Cmd+D</strong> (Mac)</p>
                    </div>
                `;
            }
            
            showModal('', '', instructions + `
                <button class="quick-btn" style="margin-top: 30px; width: 100%;" onclick="closeModal()">Ho capito!</button>
            `);
        }
        
        window.addEventListener('beforeinstallprompt', (e) => {
            Logger.log('Prompt installazione disponibile');
            e.preventDefault();
            deferredPrompt = e;
            
            if (isFirstVisit && !isAppInstalled()) {
                setTimeout(() => {
                    document.getElementById('install-prompt').classList.add('show');
                }, 3000);
            }
        });

        function installApp() {
            if (deferredPrompt) {
                Logger.log('Mostrando prompt installazione...');
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    Logger.log('Scelta utente:', choiceResult.outcome);
                    if (choiceResult.outcome === 'accepted') {
                        trackEvent('app_installed', {
                            category: 'conversion',
                            label: 'pwa_install',
                            value: 1
                        });
                        localStorage.setItem('appInstalled', 'true');
                    }
                    deferredPrompt = null;
                });
            } else {
                Logger.log('Nessun prompt disponibile, mostrando istruzioni...');
                showInstallInstructions();
            }
            hideInstallPrompt();
        }

        function hideInstallPrompt() {
            document.getElementById('install-prompt').classList.remove('show');
        }

        // ===== ERROR HANDLING =====
        window.addEventListener('error', function(e) {
            Logger.error('Errore JavaScript:', {
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno,
                error: e.error
            });
            
            // Nascondi preloader in caso di errore
            hidePreloader();
        });

        window.addEventListener('unhandledrejection', function(e) {
            Logger.error('Promise rejection non gestita:', {
                reason: e.reason,
                promise: e.promise
            });
        });

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            Logger.log('App inizializzata');
            
            // Initialize privacy
            initPrivacy();
            
            // Check URL parameters for QR tracking
            const urlParams = new URLSearchParams(window.location.search);
            const gameParam = urlParams.get('game');
            const refParam = urlParams.get('ref');
            
            if (refParam === 'qr') {
                setTimeout(() => {
                    trackQRScan();
                    Logger.log('QR Code scansionato');
                    
                    if (gameParam === 'wheel') {
                        navigateTo('fortune');
                        showModal('üéÆ', 'Benvenuto al gioco!', 
                            'Gira la ruota e prova a vincere sconti esclusivi!<br><br>' +
                            '<button class="quick-btn" onclick="closeModal()" style="margin-top: 15px;">Inizia a giocare! üéØ</button>');
                    }
                }, 1000);
            }
            
            // First visit handling
            if (isFirstVisit) {
                setTimeout(() => {
                    if (!isAppInstalled()) {
                        showInstallInstructions();
                    }
                    localStorage.setItem('hasVisited', 'true');
                }, 2000);
            }
            
            Logger.log('Configurazione completata', {
                isFirstVisit,
                isAppInstalled: isAppInstalled(),
                userAgent: navigator.userAgent,
                analyticsEnabled
            });
        });

    </script>
</body>
                </html>
