<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Salmoiraghi & Viganò - Cesano Boscone | Digital Boutique</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0a1628">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="S&V Boutique">
    <meta name="description" content="La tua boutique Salmoiraghi & Viganò sempre in tasca. Prenota visite, scopri promozioni esclusive, prova virtualmente gli occhiali.">
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LX1EQS2ESC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        
        gtag('consent', 'default', {
            'analytics_storage': 'denied',
            'ad_storage': 'denied'
        });
        
        gtag('js', new Date());
        gtag('config', 'G-LX1EQS2ESC', {
            'anonymize_ip': true,
            'allow_google_signals': false,
            'allow_ad_personalization_signals': false
        });
    </script>
    
    <!-- Luxottica Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --midnight: #0a1628;
            --champagne: #d4af37;
            --pearl: #fafafa;
            --silk: #f5f5f0;
            --smoke: #e5e5e5;
            --steel: #737373;
            --shadow: rgba(10, 22, 40, 0.1);
            --glass: rgba(250, 250, 250, 0.95);
            --emerald: #50c878;
            --ruby: #e0115f;
            --sapphire: #0f52ba;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--pearl) 0%, var(--silk) 100%);
            color: var(--midnight);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        /* Preloader - Safari Compatible */
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: var(--midnight);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            -webkit-transition: opacity 0.3s ease-out;
            -moz-transition: opacity 0.3s ease-out;
            transition: opacity 0.3s ease-out;
        }

        .preloader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .preloader.remove {
            display: none !important;
        }

        .logo-animation {
            width: 120px;
            height: 120px;
            position: relative;
        }

        .logo-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid var(--champagne);
            border-radius: 50%;
            opacity: 0;
            animation: ringPulse 2s infinite;
        }

        .logo-ring:nth-child(2) {
            animation-delay: 0.3s;
        }

        .logo-ring:nth-child(3) {
            animation-delay: 0.6s;
        }

        @keyframes ringPulse {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        /* Header - Safari Compatible */
        header {
            background: var(--glass);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            padding: 20px;
            position: -webkit-sticky;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(212, 175, 55, 0.1);
        }

        /* Fallback for older Safari */
        @supports not (backdrop-filter: blur(20px)) {
            header {
                background: rgba(250, 250, 250, 0.95);
            }
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--midnight);
            letter-spacing: -0.5px;
            text-decoration: none;
            cursor: pointer;
            position: relative;
        }

        .brand span {
            color: var(--champagne);
            font-weight: 400;
        }

        .brand-tuo {
            color: var(--champagne);
            font-size: 16px;
            font-weight: 600;
            display: block;
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .brand-location {
            color: var(--champagne);
            font-size: 12px;
            font-weight: 500;
            display: block;
            margin-top: 2px;
            text-align: right;
            font-style: italic;
            opacity: 0.9;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.1);
            z-index: 999;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            border-top: 1px solid var(--smoke);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: var(--steel);
            position: relative;
        }

        .nav-item.active {
            color: var(--champagne);
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
            transition: transform 0.3s;
        }

        .nav-item:hover .nav-icon {
            transform: translateY(-2px);
        }

        .nav-label {
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Page Container */
        .page {
            display: none;
            animation: pageIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page.active {
            display: block;
        }

        @keyframes pageIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Hero Section */
        .hero {
            min-height: 50vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            margin-bottom: 40px;
            background: radial-gradient(circle at 20% 50%, rgba(212, 175, 55, 0.1), transparent 50%);
        }

        .hero-content {
            text-align: center;
            z-index: 1;
            padding: 40px 20px;
        }

        .hero-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(32px, 7vw, 56px);
            font-weight: 400;
            margin-bottom: 16px;
            line-height: 1.2;
        }

        .hero-subtitle {
            font-weight: 300;
            font-size: clamp(14px, 3vw, 18px);
            color: rgba(10, 22, 40, 0.7);
            margin-bottom: 24px;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 24px 0;
            flex-wrap: wrap;
        }

        .quick-btn {
            background: linear-gradient(135deg, var(--champagne), #b8941f);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 30px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        .quick-btn.secondary {
            background: white;
            color: var(--midnight);
            box-shadow: 0 4px 15px var(--shadow);
        }

        /* Services Grid - Safari Flexbox Fallback */
        .services-grid {
            padding: 0 20px;
            max-width: 1200px;
            margin: 0 auto 40px;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            gap: 16px;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
        }

        /* Modern browsers with Grid support */
        @supports (display: grid) {
            .services-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        /* Flexbox fallback item sizing */
        .services-grid > * {
            -webkit-box-flex: 0;
            -ms-flex: 0 0 calc(50% - 8px);
            flex: 0 0 calc(50% - 8px);
        }

        @supports (display: grid) {
            .services-grid > * {
                -webkit-box-flex: initial;
                -ms-flex: initial;
                flex: initial;
            }
        }

        .service-card {
            background: white;
            border-radius: 20px;
            padding: 24px 16px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            box-shadow: 0 5px 20px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--champagne), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }

        .service-card:hover::before {
            transform: translateX(100%);
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(10, 22, 40, 0.15);
        }

        .service-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 12px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.2));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .service-title {
            font-family: 'Playfair Display', serif;
            font-size: 16px;
            margin-bottom: 8px;
            color: var(--midnight);
        }

        .service-desc {
            font-size: 12px;
            font-weight: 300;
            color: var(--steel);
            line-height: 1.4;
        }

        /* Promo Timer */
        .promo-banner {
            background: linear-gradient(135deg, var(--ruby), #c0105f);
            color: white;
            padding: 20px;
            margin: 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(224, 17, 95, 0.3);
        }

        .promo-title {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .promo-timer {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .timer-block {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 16px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .timer-number {
            font-size: 28px;
            font-weight: 700;
            display: block;
        }

        .timer-label {
            font-size: 10px;
            text-transform: uppercase;
            opacity: 0.9;
        }

        /* Fortune Wheel */
        .wheel-container {
            max-width: 400px;
            margin: 40px auto;
            padding: 30px;
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px var(--shadow);
        }

        .wheel-wrapper {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 0 auto 30px;
        }

        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                var(--champagne) 0deg 60deg,
                var(--midnight) 60deg 120deg,
                var(--champagne) 120deg 180deg,
                var(--midnight) 180deg 240deg,
                var(--champagne) 240deg 300deg,
                var(--midnight) 300deg 360deg
            );
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            position: relative;
            will-change: transform;
        }

        .wheel-prizes {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .prize-text {
            position: absolute;
            color: white;
            font-size: 11px;
            font-weight: 700;
            text-align: center;
            transform-origin: center;
            width: 90px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            color: var(--midnight);
            z-index: 10;
        }

        .wheel-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid var(--champagne);
            filter: drop-shadow(0 3px 10px rgba(0, 0, 0, 0.3));
            z-index: 11;
        }

        .spin-button {
            width: 100%;
            background: linear-gradient(135deg, var(--midnight), #1a2c48);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .spin-button:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(10, 22, 40, 0.3);
        }

        .spin-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 22, 40, 0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .modal.active {
            display: flex;
            animation: modalFadeIn 0.3s;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 30px;
            padding: 40px 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            animation: modalSlideUp 0.4s;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes modalSlideUp {
            from { 
                opacity: 0;
                transform: translateY(50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--silk);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 20px;
            color: var(--midnight);
        }

        .modal-close:hover {
            background: var(--champagne);
            color: white;
            transform: rotate(90deg);
        }

        /* Store Info Card */
        .store-info {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px;
            box-shadow: 0 10px 40px var(--shadow);
        }

        .store-info h2 {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            margin-bottom: 20px;
            color: var(--midnight);
        }

        .info-row {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--smoke);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.2));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .info-text {
            flex: 1;
        }

        .info-label {
            font-size: 12px;
            color: var(--steel);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 16px;
            color: var(--midnight);
            font-weight: 500;
        }

        .info-value a {
            color: inherit;
            text-decoration: none;
            transition: color 0.3s;
        }

        .info-value a:hover {
            color: var(--champagne);
        }

        /* Guide Section */
        .guides-container {
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .guide-card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px var(--shadow);
            cursor: pointer;
            transition: all 0.3s;
        }

        .guide-card:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 30px var(--shadow);
        }

        .guide-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .guide-title {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            color: var(--midnight);
        }

        .guide-icon {
            font-size: 24px;
            color: var(--champagne);
            transition: transform 0.3s;
        }

        .guide-card:hover .guide-icon {
            transform: rotate(45deg);
        }

        .guide-content {
            display: none;
            padding-top: 16px;
            border-top: 1px solid var(--smoke);
            animation: slideDown 0.3s;
        }

        .guide-content.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .guide-text {
            color: var(--steel);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .guide-tip {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.05), rgba(212, 175, 55, 0.1));
            padding: 16px;
            border-radius: 12px;
            border-left: 3px solid var(--champagne);
            margin-top: 16px;
        }

        .guide-tip-title {
            font-weight: 600;
            color: var(--midnight);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Reviews Section */
        .reviews-section {
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .review-card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 5px 20px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .review-card::before {
            content: '"';
            position: absolute;
            top: -20px;
            left: 20px;
            font-size: 80px;
            color: rgba(212, 175, 55, 0.1);
            font-family: 'Playfair Display', serif;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .review-author {
            font-weight: 600;
            color: var(--midnight);
        }

        .review-rating {
            color: var(--champagne);
            font-size: 14px;
        }

        .review-text {
            color: var(--steel);
            line-height: 1.6;
            font-style: italic;
            margin-bottom: 8px;
        }

        .review-date {
            font-size: 12px;
            color: rgba(10, 22, 40, 0.4);
        }

        .review-cta {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 30px auto;
            padding: 18px;
            background: linear-gradient(135deg, var(--champagne), #b8941f);
            color: white;
            text-align: center;
            border-radius: 15px;
            text-decoration: none;
            font-weight: 500;
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
            transition: all 0.3s;
        }

        .review-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(212, 175, 55, 0.4);
        }

        /* Footer */
        .footer {
            background: var(--midnight);
            color: white;
            padding: 40px 20px 100px;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .footer-brand {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            margin-bottom: 20px;
        }

        .footer-text {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .footer-link {
            color: var(--champagne);
            text-decoration: none;
            transition: opacity 0.3s;
        }

        .footer-link:hover {
            opacity: 0.8;
        }

        /* Install Prompt */
        .install-prompt {
            position: fixed;
            bottom: 90px;
            left: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.1);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 998;
            transform: translateY(200%);
        }

        .install-prompt.show {
            transform: translateY(0);
        }

        .install-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .install-text {
            flex: 1;
        }

        .install-title {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            margin-bottom: 4px;
            color: var(--midnight);
        }

        .install-desc {
            font-size: 14px;
            color: var(--steel);
        }

        .install-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .install-button {
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .install-button.primary {
            background: var(--champagne);
            color: white;
        }

        .install-button.secondary {
            background: var(--silk);
            color: var(--midnight);
        }

        /* Cookie Banner */
        .cookie-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--midnight);
            color: white;
            padding: 20px;
            z-index: 9998;
            transform: translateY(100%);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.2);
        }

        .cookie-banner.show {
            transform: translateY(0);
        }

        .cookie-content {
            max-width: 1000px;
            margin: 0 auto;
            text-align: center;
        }

        .cookie-title {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            margin-bottom: 12px;
            color: var(--champagne);
        }

        .cookie-text {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .cookie-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .cookie-btn {
            padding: 12px 24px;
            border-radius: 25px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .cookie-btn.accept {
            background: var(--champagne);
            color: var(--midnight);
        }

        .cookie-btn.accept:hover {
            background: #b8941f;
            transform: translateY(-2px);
        }

        .cookie-btn.customize {
            background: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .cookie-btn.customize:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .cookie-btn.reject {
            background: var(--steel);
            color: white;
        }

        /* Privacy Settings Modal */
        .privacy-modal .modal-content {
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .privacy-section {
            margin-bottom: 30px;
            text-align: left;
        }

        .privacy-section h3 {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            margin-bottom: 12px;
            color: var(--midnight);
        }

        .privacy-section p {
            color: var(--steel);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .consent-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--silk);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .toggle-info {
            flex: 1;
        }

        .toggle-title {
            font-weight: 600;
            color: var(--midnight);
            margin-bottom: 4px;
        }

        .toggle-desc {
            font-size: 13px;
            color: var(--steel);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            margin-left: 16px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--steel);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: .4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--champagne);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .services-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .promo-timer {
                gap: 8px;
            }
            
            .timer-block {
                padding: 8px 12px;
            }
            
            .timer-number {
                font-size: 20px;
            }
            
            .wheel-wrapper {
                width: 240px;
                height: 240px;
            }
            
            .prize-text {
                font-size: 9px;
                width: 60px;
            }

            .install-content {
                flex-direction: column;
                text-align: center;
            }

            .install-buttons {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .hero-title {
                font-size: 28px;
            }
            
            .modal-content {
                margin: 20px;
                padding: 30px 20px;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .quick-btn {
                width: 200px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Preloader -->
            <div class="preloader" id="preloader">
        <div class="logo-animation">
            <div class="logo-ring"></div>
            <div class="logo-ring"></div>
            <div class="logo-ring"></div>
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--champagne); font-family: 'Playfair Display', serif; font-size: 32px;">S&V</div>
        </div>
    </div>

    <!-- STYLE ADVISOR PAGE -->
    <div id="styleadvisor-page" class="page">
        <div class="hero" style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white;">
            <div class="hero-content">
                <h1 class="hero-title" style="color: white;">Style Advisor <span style="color: rgba(255, 255, 255, 0.8);">Cesano</span></h1>
                <p class="hero-subtitle" style="color: rgba(255, 255, 255, 0.9);">La scienza dell'armocromia incontra l'arte dell'ottica</p>
                <div style="background: rgba(255, 255, 255, 0.2); color: white; padding: 12px 24px; border-radius: 30px; display: inline-block; margin-top: 20px; font-weight: 600;">
                    ✨ Scopri la montatura perfetta per te
                </div>
            </div>
        </div>

        <!-- Test Container -->
        <div id="style-test-container" style="padding: 0 20px; max-width: 700px; margin: 0 auto;">
            
            <!-- Introduction -->
            <div id="test-intro" style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px var(--shadow); text-align: center;">
                <div style="font-size: 48px; margin-bottom: 20px;">🎨</div>
                <h2 style="font-family: 'Playfair Display', serif; font-size: 32px; margin-bottom: 20px; color: var(--midnight);">
                    L'Arte di Scegliere la Montatura Giusta
                </h2>
                
                <div style="background: linear-gradient(135deg, rgba(78, 205, 196, 0.05), rgba(78, 205, 196, 0.1)); border-radius: 15px; padding: 25px; margin-bottom: 30px; text-align: left;">
                    <h3 style="color: var(--midnight); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="color: #4ecdc4;">🎯</span> Armocromia + Armonia delle Forme
                    </h3>
                    <p style="color: var(--steel); line-height: 1.6; margin-bottom: 15px;">
                        <strong>Armocromia:</strong> L'analisi dei colori che valorizzano la tua carnagione naturale
                    </p>
                    <p style="color: var(--steel); line-height: 1.6;">
                        <strong>Armonia delle Forme:</strong> L'equilibrio tra la forma del viso e la geometria della montatura
                    </p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; border-left: 4px solid #4ecdc4;">
                        <div style="font-size: 24px; margin-bottom: 10px;">👁️</div>
                        <h4 style="color: var(--midnight); margin-bottom: 8px;">Forma del Viso</h4>
                        <p style="color: var(--steel); font-size: 14px;">Identifichiamo le tue proporzioni naturali</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; border-left: 4px solid #4ecdc4;">
                        <div style="font-size: 24px; margin-bottom: 10px;">🌈</div>
                        <h4 style="color: var(--midnight); margin-bottom: 8px;">Palette Colori</h4>
                        <p style="color: var(--steel); font-size: 14px;">I colori che esaltano la tua bellezza</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; border-left: 4px solid #4ecdc4;">
                        <div style="font-size: 24px; margin-bottom: 10px;">💎</div>
                        <h4 style="color: var(--midnight); margin-bottom: 8px;">Stile Personale</h4>
                        <p style="color: var(--steel); font-size: 14px;">Riflette la tua personalità unica</p>
                    </div>
                </div>

                <button class="quick-btn" onclick="startStyleTest()" style="font-size: 18px; padding: 18px 36px;">
                    ✨ Inizia il Tuo Test Personalizzato
                </button>
                
                <p style="color: var(--steel); font-size: 14px; margin-top: 20px;">
                    📋 Test veloce: solo 4 domande • ⏱️ Durata: 2 minuti
                </p>
            </div>

            <!-- Test Questions (Hidden initially) -->
            <div id="test-questions" style="display: none;">
                <!-- Questions will be loaded here by JavaScript -->
            </div>

            <!-- Test Results (Hidden initially) -->
            <div id="test-results" style="display: none;">
                <!-- Results will be loaded here by JavaScript -->
            </div>
        </div>
    </div>


                </div>
            </div>
        </div>
    </div>

    <!-- CATALOGO PAGE -->
    <div id="catalogo-page" class="page">
        <div class="hero">
            <div class="hero-content">
                <h1 class="hero-title">Catalogo Prodotti</h1>
                <p class="hero-subtitle">Scopri l'intera collezione Salmoiraghi & Viganò</p>
            </div>
        </div>

        <div style="padding: 0 20px; max-width: 800px; margin: 0 auto;">
            <div style="background: white; border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 40px var(--shadow); text-align: center;">
                <div style="font-size: 48px; margin-bottom: 20px;">🌟</div>
                <h2 style="font-family: 'Playfair Display', serif; font-size: 24px; margin-bottom: 16px; color: var(--midnight);">
                    Scopri tutte le collezioni online
                </h2>
                <p style="color: var(--steel); margin-bottom: 30px; line-height: 1.6;">
                    Naviga il catalogo completo sul sito ufficiale Salmoiraghi & Viganò.<br>
                    <strong>Vieni poi in negozio per provarli e ricevere la consulenza personalizzata!</strong>
                </p>
            </div>

            <div class="services-grid" style="grid-template-columns: 1fr; gap: 20px;">
                <div class="service-card" onclick="openCatalog('vista')" style="padding: 30px; text-align: left;">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.2)); padding: 20px; border-radius: 15px; font-size: 32px;">👓</div>
                        <div style="flex: 1;">
                            <h3 style="font-family: 'Playfair Display', serif; font-size: 22px; margin-bottom: 8px; color: var(--midnight);">Occhiali da Vista</h3>
                            <p style="color: var(--steel); margin-bottom: 15px;">Tutte le montature e i brand più prestigiosi</p>
                            <p style="font-size: 14px; color: var(--champagne); font-weight: 600;">Sfoglia online → Prova in negozio</p>
                        </div>
                    </div>
                </div>

                <div class="service-card" onclick="openCatalog('sole')" style="padding: 30px; text-align: left;">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.2)); padding: 20px; border-radius: 15px; font-size: 32px;">🕶️</div>
                        <div style="flex: 1;">
                            <h3 style="font-family: 'Playfair Display', serif; font-size: 22px; margin-bottom: 8px; color: var(--midnight);">Occhiali da Sole</h3>
                            <p style="color: var(--steel); margin-bottom: 15px;">Ray-Ban, Oakley, Prada e tutti i top brand</p>
                            <p style="font-size: 14px; color: var(--champagne); font-weight: 600;">Protezione UV garantita</p>
                        </div>
                    </div>
                </div>

                <div class="service-card" onclick="openCatalog('lac')" style="padding: 30px; text-align: left;">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.2)); padding: 20px; border-radius: 15px; font-size: 32px;">👁️</div>
                        <div style="flex: 1;">
                            <h3 style="font-family: 'Playfair Display', serif; font-size: 22px; margin-bottom: 8px; color: var(--midnight);">Lenti a Contatto</h3>
                            <p style="color: var(--steel); margin-bottom: 15px;">Giornaliere, quindicinali, mensili e colorate</p>
                            <p style="font-size: 14px; color: var(--champagne); font-weight: 600;">Spedizione gratuita</p>
                        </div>
                    </div>
                </div>

                <div class="service-card" onclick="openCatalog('accessori')" style="padding: 30px; text-align: left;">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.2)); padding: 20px; border-radius: 15px; font-size: 32px;">🧽</div>
                        <div style="flex: 1;">
                            <h3 style="font-family: 'Playfair Display', serif; font-size: 22px; margin-bottom: 8px; color: var(--midnight);">Prodotti per la Cura</h3>
                            <p style="color: var(--steel); margin-bottom: 15px;">Soluzioni, spray, panni e custodie</p>
                            <p style="font-size: 14px; color: var(--champagne); font-weight: 600;">Manutenzione professionale</p>
                        </div>
                    </div>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, var(--silk), var(--pearl)); border-radius: 20px; padding: 30px; margin: 30px 0; text-align: center;">
                <h3 style="font-family: 'Playfair Display', serif; font-size: 20px; margin-bottom: 15px; color: var(--midnight);">
                    ✨ Servizi Esclusivi del negozio di Cesano
                </h3>
                <div style="display: grid; gap: 15px; margin-bottom: 25px;">
                    <div style="display: flex; align-items: center; gap: 12px; justify-content: center;">
                        <span style="color: var(--champagne);">👁️</span>
                        <span style="color: var(--steel);">Controllo della vista gratuito</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; justify-content: center;">
                        <span style="color: var(--champagne);">🔧</span>
                        <span style="color: var(--steel);">Regolazione e riparazione montature</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; justify-content: center;">
                        <span style="color: var(--champagne);">💎</span>
                        <span style="color: var(--steel);">Consulenza personalizzata dal team di Cesano</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; justify-content: center;">
                        <span style="color: var(--champagne);">🏆</span>
                        <span style="color: var(--steel);">Garanzia e assistenza post-vendita</span>
                    </div>
                </div>
                <p style="color: var(--midnight); font-weight: 500;">
                    Quello che trovi online, lo provi e personalizzi nel TUO negozio!
                </p>
            </div>

            <!-- Club &Te Upsell -->
            <div style="background: linear-gradient(135deg, var(--midnight), #1a2c48); color: white; border-radius: 20px; padding: 30px; text-align: center; position: relative; overflow: hidden;">
                <div style="position: absolute; top: -50px; right: -50px; width: 100px; height: 100px; background: rgba(212, 175, 55, 0.1); border-radius: 50%;"></div>
                
                <div style="position: relative; z-index: 1;">
                    <div style="font-size: 48px; margin-bottom: 15px;">💎</div>
                    <h3 style="font-family: 'Playfair Display', serif; font-size: 24px; margin-bottom: 15px;">
                        Hai visto qualcosa che ti piace?<br>
                        <span style="color: var(--champagne);">Club &Te</span> è la soluzione!
                    </h3>
                    <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 25px; font-size: 16px;">
                        <strong>3 occhiali in 3 anni</strong> da solo 20€/mese<br>
                        Scegli tutto quello che vuoi dal catalogo online
                    </p>
                    
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="quick-btn secondary" onclick="navigateTo('clubete')" style="background: var(--champagne); color: var(--midnight);">
                            📖 Scopri Club &Te Cesano
                        </button>
                        <a href="https://wa.me/390245862417?text=Ciao,%20ho%20visto%20alcuni%20occhiali%20che%20mi%20piacciono%20nel%20catalogo.%20Vorrei%20info%20sul%20Club%20%26Te%20a%20Cesano" target="_blank" class="quick-btn secondary" style="background: white; color: var(--midnight);" onclick="trackWhatsAppClick('catalog_club_te')">
                            💬 Chiedi Info
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RIORDINI LAC PAGE -->
    <div id="riordini-page" class="page">
        <div class="hero">
            <div class="hero-content">
                <h1 class="hero-title">Riordina le tue <span style="color: var(--champagne);">Lenti a Contatto</span></h1>
                <p class="hero-subtitle">Veloce, semplice, sempre le stesse che usi</p>
            </div>
        </div>

        <div style="padding: 0 20px; max-width: 600px; margin: 0 auto;">
            <div style="background: white; border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 40px var(--shadow);">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">🔄</div>
                    <h2 style="font-family: 'Playfair Display', serif; font-size: 24px; margin-bottom: 16px; color: var(--midnight);">
                        Riordino Veloce
                    </h2>
                    <p style="color: var(--steel); line-height: 1.6;">
                        Usi sempre le stesse lenti a contatto?<br>
                        Riordinale velocemente tramite WhatsApp!
                    </p>
                </div>

                <div style="background: var(--silk); border-radius: 15px; padding: 25px; margin-bottom: 30px;">
                    <h3 style="color: var(--midnight); margin-bottom: 15px; font-size: 18px;">📦 Come funziona:</h3>
                    <div style="display: grid; gap: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; flex-shrink: 0;">1</div>
                            <p style="color: var(--steel); margin: 0;">Clicca "Riordina LAC" qui sotto</p>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; flex-shrink: 0;">2</div>
                            <p style="color: var(--steel); margin: 0;">Comunicaci marca, modello e gradazione</p>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; flex-shrink: 0;">3</div>
                            <p style="color: var(--steel); margin: 0;">Ti confermiamo disponibilità e prezzo</p>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; flex-shrink: 0;">4</div>
                            <p style="color: var(--steel); margin: 0;">Ritira in negozio o ricevi a casa</p>
                        </div>
                    </div>
                </div>

                <div style="text-align: center;">
                    <a href="https://wa.me/390245862417?text=Ciao%2C%20vorrei%20riordinare%20le%20mie%20lenti%20a%20contatto.%0A%0AMarca%3A%20%0AModello%3A%20%0AGradazione%20OD%3A%20%0AGradazione%20OS%3A%20%0AQuantit%C3%A0%3A%20%0A%0AGrazie%21" target="_blank" class="quick-btn" style="font-size: 16px; padding: 16px 32px; margin-bottom: 20px;" onclick="trackWhatsAppClick('lac_reorder')">
                        💬 Riordina LAC
                    </a>
                </div>
            </div>

            <div class="services-grid" style="grid-template-columns: 1fr; gap: 15px; margin-bottom: 30px;">
                <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 20px var(--shadow);">
                    <h4 style="color: var(--midnight); margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                        <span style="color: var(--champagne);">💰</span> Prezzi Vantaggiosi
                    </h4>
                    <p style="color: var(--steel); font-size: 14px; margin: 0;">Gli stessi prezzi del negozio, spedizione gratuita sopra i 50€</p>
                </div>

                <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 20px var(--shadow);">
                    <h4 style="color: var(--midnight); margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                        <span style="color: var(--champagne);">⚡</span> Consegna Veloce
                    </h4>
                    <p style="color: var(--steel); font-size: 14px; margin: 0;">Disponibilità immediata per le marche più comuni</p>
                </div>

                <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 20px var(--shadow);">
                    <h4 style="color: var(--midnight); margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                        <span style="color: var(--champagne);">🛡️</span> Garanzia Qualità
                    </h4>
                    <p style="color: var(--steel); font-size: 14px; margin: 0;">Prodotti originali, stessa qualità del negozio</p>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, var(--midnight), #1a2c48); color: white; border-radius: 20px; padding: 30px; text-align: center;">
                <h3 style="font-family: 'Playfair Display', serif; font-size: 22px; margin-bottom: 15px;">
                    🆕 Prime volte con le LAC?
                </h3>
                <p style="margin-bottom: 25px; opacity: 0.9; line-height: 1.5;">
                    Prenota una consulenza in negozio per la prima applicazione<br>
                    e impara ad usarle in sicurezza
                </p>
                <a href="https://wa.me/390245862417?text=Vorrei%20una%20consulenza%20per%20iniziare%20ad%20usare%20le%20lenti%20a%20contatto" target="_blank" class="quick-btn secondary" style="background: white; color: var(--midnight);" onclick="trackWhatsAppClick('lac_consultation')">
                    👁️ Prenota Consulenza LAC
                </a>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="header-content">
            <a href="#home" class="brand" onclick="navigateTo('home')">
                <span class="brand-tuo">Il TUO</span>
                Salmoiraghi <span>&</span> Viganò
                <span class="brand-location">di Cesano Boscone</span>
            </a>
        </div>
    </header>

    <!-- HOME PAGE -->
    <div id="home-page" class="page active">
        <section class="hero">
            <div class="hero-content">
                <h1 class="hero-title">Il TUO Salmoiraghi & Viganò<br><span style="color: var(--champagne);">di Cesano Boscone</span></h1>
                <p class="hero-subtitle">La tua boutique di fiducia • Le Porte di Milano</p>
                <div class="quick-actions">
                    <a href="tel:+390245862417" class="quick-btn" onclick="trackPhoneClick('hero')">
                        📞 Chiama Cesano
                    </a>
                    <a href="https://wa.me/390245862417?text=Ciao,%20scrivo%20dal%20vostro%20sito%20di%20Cesano%20Boscone.%20Vorrei%20informazioni" target="_blank" class="quick-btn secondary" onclick="trackWhatsAppClick('hero')">
                        💬 Scrivici
                    </a>
                </div>
            </div>
        </section>

        <!-- Club &Te Highlight -->
        <div style="background: linear-gradient(135deg, var(--midnight), #1a2c48); color: white; margin: 20px; border-radius: 20px; padding: 30px; text-align: center; position: relative; overflow: hidden;">
            <div style="position: absolute; top: -50px; right: -50px; width: 100px; height: 100px; background: rgba(212, 175, 55, 0.1); border-radius: 50%;"></div>
            <div style="position: absolute; bottom: -30px; left: -30px; width: 80px; height: 80px; background: rgba(212, 175, 55, 0.1); border-radius: 50%;"></div>
            
            <div style="position: relative; z-index: 1;">
                <div style="font-size: 48px; margin-bottom: 15px;">💎</div>
                <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 15px;">
                    Club <span style="color: var(--champagne);">&Te</span> Cesano
                </h2>
                <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 20px; font-size: 16px;">
                    <strong>3 occhiali in 3 anni</strong> da solo 20€/mese<br>
                    Il nostro programma più amato dai clienti di Cesano!
                </p>
                
                <div style="background: var(--champagne); color: var(--midnight); padding: 12px 24px; border-radius: 25px; display: inline-block; margin-bottom: 25px; font-weight: 600; font-size: 16px;">
                    ⚡ Attivazione immediata in negozio
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="quick-btn secondary" onclick="navigateTo('clubete')" style="background: white; color: var(--midnight);">
                        📖 Scopri il Club &Te
                    </button>
                    <a href="https://wa.me/390245862417?text=Ciao,%20vorrei%20informazioni%20sul%20Club%20%26Te%20nel%20vostro%20negozio%20di%20Cesano%20Boscone" target="_blank" class="quick-btn secondary" style="background: var(--champagne); color: var(--midnight);" onclick="trackWhatsAppClick('club_te_hero')">
                        💬 Info Club &Te
                    </a>
                </div>
            </div>
        </div>

        <!-- Style Advisor Banner -->
        <div style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; margin: 20px; border-radius: 20px; padding: 30px; text-align: center; position: relative; overflow: hidden;">
            <div style="position: absolute; top: -30px; left: -30px; width: 80px; height: 80px; background: rgba(255, 255, 255, 0.1); border-radius: 50%;"></div>
            <div style="position: absolute; bottom: -40px; right: -40px; width: 100px; height: 100px; background: rgba(255, 255, 255, 0.1); border-radius: 50%;"></div>
            
            <div style="position: relative; z-index: 1;">
                <div style="font-size: 48px; margin-bottom: 15px;">✨</div>
                <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 15px;">
                    Style Advisor <span style="color: rgba(255, 255, 255, 0.8);">Cesano</span>
                </h2>
                <p style="color: rgba(255, 255, 255, 0.95); margin-bottom: 20px; font-size: 16px;">
                    <strong>Scopri la montatura perfetta per te!</strong><br>
                    Armocromia + Armonia delle forme = Il TUO stile ideale
                </p>
                
                <div style="background: rgba(255, 255, 255, 0.2); color: white; padding: 12px 24px; border-radius: 25px; display: inline-block; margin-bottom: 25px; font-weight: 500; font-size: 14px;">
                    🎯 Test personalizzato + Consulenza a Cesano
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="quick-btn secondary" onclick="navigateTo('styleadvisor')" style="background: white; color: var(--midnight);">
                        ✨ Scopri il Tuo Stile
                    </button>
                    <a href="https://wa.me/390245862417?text=Ciao%2C%20vorrei%20una%20consulenza%20personalizzata%20per%20scegliere%20la%20montatura%20ideale%20nel%20vostro%20negozio%20di%20Cesano" target="_blank" class="quick-btn secondary" style="background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3);" onclick="trackWhatsAppClick('style_advisor_hero')">
                        💬 Consulenza Diretta
                    </a>
                </div>
            </div>
        </div>

        <div class="promo-banner">
            <h2 class="promo-title">🎁 Offerta Esclusiva Cesano</h2>
            <p style="margin-bottom: 16px;"><strong>Seconda coppia al 50%</strong> - Solo nel nostro negozio!</p>
            <div class="promo-timer">
                <div class="timer-block">
                    <span class="timer-number" id="timer-hours">24</span>
                    <span class="timer-label">Ore</span>
                </div>
                <div class="timer-block">
                    <span class="timer-number" id="timer-minutes">00</span>
                    <span class="timer-label">Min</span>
                </div>
                <div class="timer-block">
                    <span class="timer-number" id="timer-seconds">00</span>
                    <span class="timer-label">Sec</span>
                </div>
            </div>
        </div>

        <div class="services-grid">
            <div class="service-card" onclick="navigateTo('prenota')">
                <div class="service-icon">📅</div>
                <h3 class="service-title">Prenota a Cesano</h3>
                <p class="service-desc">Visita nel nostro negozio</p>
            </div>
            
            <div class="service-card" onclick="navigateTo('clubete')" style="background: linear-gradient(135deg, var(--champagne), #b8941f); color: white; border: none; box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3); transform: scale(1.05);">
                <div class="service-icon" style="background: rgba(255, 255, 255, 0.2); color: white;">💎</div>
                <h3 class="service-title" style="color: white; font-size: 18px;">Club &Te Cesano</h3>
                <p class="service-desc" style="color: rgba(255, 255, 255, 0.9);">Il programma più amato!</p>
            </div>
            
            <div class="service-card" onclick="navigateTo('catalogo')">
                <div class="service-icon">🛒</div>
                <h3 class="service-title">Catalogo</h3>
                <p class="service-desc">Sfoglia tutti i prodotti online</p>
            </div>
            
            <div class="service-card" onclick="navigateTo('clubete')">
                <div class="service-icon">💎</div>
                <h3 class="service-title">Club &Te</h3>
                <p class="service-desc">3 occhiali in 3 anni da 20€/mese</p>
            </div>
            
            <div class="service-card" onclick="navigateTo('riordini')">
                <div class="service-icon">🔄</div>
                <h3 class="service-title">Riordini LAC</h3>
                <p class="service-desc">Riordina le tue lenti a contatto</p>
            </div>
            
            <div class="service-card" onclick="navigateTo('giochi')">
                <div class="service-icon">🎮</div>
                <h3 class="service-title">Giochi</h3>
                <p class="service-desc">Divertiti e vinci premi!</p>
            </div>
            
            <div class="service-card" onclick="openMaps()">
                <div class="service-icon">📍</div>
                <h3 class="service-title">Dove Siamo</h3>
                <p class="service-desc">Indicazioni stradali</p>
            </div>
            
            <div class="service-card" onclick="openGoogleReviews()">
                <div class="service-icon">⭐</div>
                <h3 class="service-title">Recensioni</h3>
                <p class="service-desc">4.8/5 su Google</p>
            </div>
            
            <div class="service-card" onclick="navigateTo('negozio')">
                <div class="service-icon">🏪</div>
                <h3 class="service-title">Il Negozio</h3>
                <p class="service-desc">Orari, contatti e guide</p>
            </div>
        </div>
    </div>

    <!-- PRENOTA PAGE -->
    <div id="prenota-page" class="page">
        <div class="hero">
            <div class="hero-content">
                <h1 class="hero-title">Prenota nel TUO negozio di <span style="color: var(--champagne);">Cesano</span></h1>
                <p class="hero-subtitle">Il team di Cesano Boscone ti aspetta</p>
            </div>
        </div>

        <div class="services-grid" style="max-width: 600px; margin: 0 auto;">
            <div class="service-card" onclick="bookAppointment('Controllo Vista')">
                <div class="service-icon">👁️</div>
                <h3 class="service-title">Controllo Vista</h3>
                <p class="service-desc">Esame completo della vista</p>
            </div>
            
            <div class="service-card" onclick="bookAppointment('Scelta Montature')">
                <div class="service-icon">👓</div>
                <h3 class="service-title">Scelta Montature</h3>
                <p class="service-desc">Consulenza personalizzata</p>
            </div>
            
            <div class="service-card" onclick="bookAppointment('Lenti a Contatto')">
                <div class="service-icon">👁️‍🗨️</div>
                <h3 class="service-title">Lenti a Contatto</h3>
                <p class="service-desc">Applicazione e training</p>
            </div>
            
            <div class="service-card" onclick="bookAppointment('Ritiro Occhiali')">
                <div class="service-icon">📦</div>
                <h3 class="service-title">Ritiro Occhiali</h3>
                <p class="service-desc">Ritira il tuo ordine</p>
            </div>
            
            <div class="service-card" onclick="bookAppointment('Assistenza')">
                <div class="service-icon">🔧</div>
                <h3 class="service-title">Assistenza</h3>
                <p class="service-desc">Riparazioni e regolazioni</p>
            </div>
            
            <div class="service-card" onclick="bookAppointment('Consulenza Sole')">
                <div class="service-icon">🕶️</div>
                <h3 class="service-title">Occhiali Sole</h3>
                <p class="service-desc">Protezione e stile</p>
            </div>
        </div>

        <div style="text-align: center; margin: 40px 20px;">
            <p style="color: var(--steel); margin-bottom: 20px;">Preferisci parlare direttamente con il nostro team di Cesano?</p>
            <div class="quick-actions">
                <a href="tel:+390245862417" class="quick-btn" onclick="trackPhoneClick('appointment_page')">📞 Chiama Cesano</a>
            </div>
        </div>
    </div>

    <!-- CLUB &TE PAGE -->
    <div id="clubete-page" class="page">
        <div class="hero" style="background: linear-gradient(135deg, var(--midnight), #1a2c48); color: white;">
            <div class="hero-content">
                <h1 class="hero-title" style="color: white;">Club <span style="color: var(--champagne);">&Te</span> <br>Cesano Boscone</h1>
                <p class="hero-subtitle" style="color: rgba(255, 255, 255, 0.9);">Il programma di successo del nostro negozio</p>
                <div style="background: var(--champagne); color: var(--midnight); padding: 12px 24px; border-radius: 30px; display: inline-block; margin-top: 20px; font-weight: 600;">
                    🏪 Attivo nel nostro negozio di Cesano
                </div>
            </div>
        </div>

        <div style="background: white; padding: 30px 20px; margin: 20px; border-radius: 20px; box-shadow: 0 10px 40px var(--shadow);">
            <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; text-align: center; margin-bottom: 30px;">
                Il <span style="color: var(--champagne);">Club &Te</span> del TUO Salmoiraghi di Cesano
            </h2>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="background: linear-gradient(135deg, var(--champagne), #b8941f); color: white; padding: 16px 32px; border-radius: 30px; display: inline-block; margin-bottom: 20px; font-size: 20px; font-weight: 700;">
                    3 occhiali in 3 anni da 20€/mese
                </div>
                <p style="color: var(--steel); font-size: 16px;">
                    ⚡ <strong>Attivazione immediata</strong> nel nostro negozio di Cesano Boscone<br>
                    🎯 <strong>Consulenza personalizzata</strong> dal nostro team locale
                </p>
            </div>
            
            <div style="display: grid; gap: 20px; margin-bottom: 30px;">
                <div style="display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--silk); border-radius: 15px;">
                    <div style="font-size: 32px;">🎯</div>
                    <div>
                        <h3 style="color: var(--midnight); margin-bottom: 4px;">Subito 2 occhiali!</h3>
                        <p style="color: var(--steel); font-size: 14px;">Puoi fare anche tutti e 3 gli occhiali insieme, subito al momento dell'iscrizione</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--silk); border-radius: 15px;">
                    <div style="font-size: 32px;">💰</div>
                    <div>
                        <h3 style="color: var(--midnight); margin-bottom: 4px;">Paghi a rate mensili</h3>
                        <p style="color: var(--steel); font-size: 14px;">Solo 20€/mese per lenti monofocali, 35€/mese per progressive</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--silk); border-radius: 15px;">
                    <div style="font-size: 32px;">🛡️</div>
                    <div>
                        <h3 style="color: var(--midnight); margin-bottom: 4px;">Garanzia Senza Pensieri</h3>
                        <p style="color: var(--steel); font-size: 14px;">Copertura 100% da rottura, furto, smarrimento o cambio gradazione</p>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--silk); border-radius: 15px;">
                    <div style="font-size: 32px;">👓</div>
                    <div>
                        <h3 style="color: var(--midnight); margin-bottom: 4px;">Ampia scelta di brand</h3>
                        <p style="color: var(--steel); font-size: 14px;">Ray-Ban, Oakley, Prada, Versace e tanti altri marchi prestigiosi</p>
                    </div>
                </div>
            </div>

            <div style="text-align: center;">
                <a href="https://wa.me/390245862417?text=Ciao,%20vorrei%20iscrivermi%20al%20Club%20%26Te%20nel%20vostro%20negozio%20di%20Cesano%20Boscone.%20Quando%20posso%20venire%3F" target="_blank" class="quick-btn" style="font-size: 16px; padding: 16px 32px;" onclick="trackWhatsAppClick('club_te_signup')">
                    💬 Iscriviti nel nostro negozio
                </a>
            </div>
        </div>

        <!-- Altri contenuti Club &Te rimangono identici -->
        <!-- ... resto del contenuto Club &Te ... -->
    </div>

    <!-- GIOCHI PAGE -->
    <div id="giochi-page" class="page">
        <div class="hero" style="background: linear-gradient(135deg, var(--midnight), #1a2c48); color: white;">
            <div class="hero-content">
                <h1 class="hero-title" style="color: white;">Game Hub <span style="color: var(--champagne);">S&V</span></h1>
                <p class="hero-subtitle" style="color: rgba(255, 255, 255, 0.9);">Gioca, divertiti e vinci premi esclusivi!</p>
                <div style="background: var(--champagne); color: var(--midnight); padding: 8px 16px; border-radius: 20px; display: inline-block; margin-top: 16px; font-size: 14px; font-weight: 600;">
                    🎁 Una vittoria al giorno per tutti i giochi
                </div>
            </div>
        </div>

        <!-- Games Grid -->
        <div style="padding: 0 20px; max-width: 800px; margin: 0 auto;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
                
                <!-- Ruota della Fortuna -->
                <div class="service-card" onclick="playGame('wheel')" style="background: linear-gradient(135deg, #ff6b6b, #ee5a52); color: white; border: none; box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);">
                    <div style="font-size: 48px; margin-bottom: 15px;">🎡</div>
                    <h3 style="color: white; font-size: 20px; margin-bottom: 10px;">Ruota della Fortuna</h3>
                    <p style="color: rgba(255, 255, 255, 0.9); font-size: 14px; margin-bottom: 15px;">Gira e scopri il tuo premio!</p>
                    <div style="background: rgba(255, 255, 255, 0.2); padding: 8px 12px; border-radius: 12px; font-size: 12px;">
                        ⚡ Gioco veloce
                    </div>
                </div>

                <!-- Test della Vista -->
                <div class="service-card" onclick="playGame('eyetest')" style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; border: none; box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3);">
                    <div style="font-size: 48px; margin-bottom: 15px;">👁️</div>
                    <h3 style="color: white; font-size: 20px; margin-bottom: 10px;">Sfida la Vista</h3>
                    <p style="color: rgba(255, 255, 255, 0.9); font-size: 14px; margin-bottom: 15px;">Test di lettura progressivo</p>
                    <div style="background: rgba(255, 255, 255, 0.2); padding: 8px 12px; border-radius: 12px; font-size: 12px;">
                        🧠 Educativo
                    </div>
                </div>

                <!-- Indovina il Brand -->
                <div class="service-card" onclick="playGame('brandquiz')" style="background: linear-gradient(135deg, #a8e6cf, #7fcdcd); color: white; border: none; box-shadow: 0 10px 30px rgba(168, 230, 207, 0.3);">
                    <div style="font-size: 48px; margin-bottom: 15px;">🕶️</div>
                    <h3 style="color: white; font-size: 20px; margin-bottom: 10px;">Indovina il Brand</h3>
                    <p style="color: rgba(255, 255, 255, 0.9); font-size: 14px; margin-bottom: 15px;">Riconosci le montature famose</p>
                    <div style="background: rgba(255, 255, 255, 0.2); padding: 8px 12px; border-radius: 12px; font-size: 12px;">
                        🏆 Challenge
                    </div>
                </div>

                <!-- Quiz dell'Ottico -->
                <div class="service-card" onclick="playGame('optician')" style="background: linear-gradient(135deg, #ffd93d, #ff6b35); color: white; border: none; box-shadow: 0 10px 30px rgba(255, 217, 61, 0.3);">
                    <div style="font-size: 48px; margin-bottom: 15px;">🧠</div>
                    <h3 style="color: white; font-size: 20px; margin-bottom: 10px;">Quiz dell'Ottico</h3>
                    <p style="color: rgba(255, 255, 255, 0.9); font-size: 14px; margin-bottom: 15px;">Storia e curiosità S&V</p>
                    <div style="background: rgba(255, 255, 255, 0.2); padding: 8px 12px; border-radius: 12px; font-size: 12px;">
                        📚 Cultura
                    </div>
                </div>

                <!-- Personalizzatore -->
                <div class="service-card" onclick="playGame('creator')" style="background: linear-gradient(135deg, #a8edea, #fed6e3); color: var(--midnight); border: none; box-shadow: 0 10px 30px rgba(168, 237, 234, 0.3);">
                    <div style="font-size: 48px; margin-bottom: 15px;">🎨</div>
                    <h3 style="color: var(--midnight); font-size: 20px; margin-bottom: 10px;">Crea il Tuo Occhiale</h3>
                    <p style="color: rgba(10, 22, 40, 0.7); font-size: 14px; margin-bottom: 15px;">Personalizza stile e colori</p>
                    <div style="background: rgba(10, 22, 40, 0.1); padding: 8px 12px; border-radius: 12px; font-size: 12px; color: var(--midnight);">
                        ✨ Creativo
                    </div>
                </div>

                <!-- Memory Game -->
                <div class="service-card" onclick="playGame('memory')" style="background: linear-gradient(135deg, #d299c2, #fef9d7); color: var(--midnight); border: none; box-shadow: 0 10px 30px rgba(210, 153, 194, 0.3);">
                    <div style="font-size: 48px; margin-bottom: 15px;">🃏</div>
                    <h3 style="color: var(--midnight); font-size: 20px; margin-bottom: 10px;">Memory Montature</h3>
                    <p style="color: rgba(10, 22, 40, 0.7); font-size: 14px; margin-bottom: 15px;">Trova le coppie uguali</p>
                    <div style="background: rgba(10, 22, 40, 0.1); padding: 8px 12px; border-radius: 12px; font-size: 12px; color: var(--midnight);">
                        🧩 Memoria
                    </div>
                </div>
            </div>

            <!-- Premi Info -->
            <div style="background: white; border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 40px var(--shadow);">
                <h2 style="font-family: 'Playfair Display', serif; text-align: center; margin-bottom: 25px; color: var(--midnight);">
                    🏆 Premi Disponibili
                </h2>
                
                <div style="display: grid; gap: 15px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: var(--silk); border-radius: 12px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 24px;">👓</span>
                            <span style="color: var(--midnight); font-weight: 500;">50% su occhiale da vista*</span>
                        </div>
                        <span style="background: var(--ruby); color: white; padding: 4px 8px; border-radius: 8px; font-size: 12px; font-weight: 600;">5%</span>
                    </div>
                    
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: var(--silk); border-radius: 12px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 24px;">💰</span>
                            <span style="color: var(--midnight); font-weight: 500;">€50 extra sconto vista</span>
                        </div>
                        <span style="background: var(--champagne); color: white; padding: 4px 8px; border-radius: 8px; font-size: 12px; font-weight: 600;">15%</span>
                    </div>
                    
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: var(--silk); border-radius: 12px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 24px;">👁️</span>
                            <span style="color: var(--midnight); font-weight: 500;">25% su due confezioni LAC</span>
                        </div>
                        <span style="background: var(--sapphire); color: white; padding: 4px 8px; border-radius: 8px; font-size: 12px; font-weight: 600;">20%</span>
                    </div>
                    
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: var(--silk); border-radius: 12px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 24px;">🕶️</span>
                            <span style="color: var(--midnight); font-weight: 500;">20% occhiale da sole</span>
                        </div>
                        <span style="background: var(--emerald); color: white; padding: 4px 8px; border-radius: 8px; font-size: 12px; font-weight: 600;">60%</span>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, rgba(212, 175, 55, 0.05), rgba(212, 175, 55, 0.1)); border-radius: 12px; border-left: 3px solid var(--champagne);">
                    <p style="font-size: 13px; color: var(--steel); margin: 0; line-height: 1.5;">
                        <strong>Come funziona:</strong> Gioca tutti i giochi che vuoi, ma puoi vincere solo una volta al giorno (per tutti i giochi). 
                        I codici premio sono validi 7 giorni. *Minima spesa pre-sconto €50.
                    </p>
                </div>
            </div>

            <!-- Game Container -->
            <div id="game-container" style="display: none;">
                <!-- I singoli giochi verranno caricati qui -->
            </div>
        </div>
    </div>

    <!-- NEGOZIO PAGE -->
    <div id="negozio-page" class="page">
        <div class="hero">
            <div class="hero-content">
                <h1 class="hero-title">Il TUO negozio di <span style="color: var(--champagne);">Cesano Boscone</span></h1>
                <p class="hero-subtitle">Esperienza e professionalità dal 1865 • Le Porte di Milano</p>
            </div>
        </div>

        <div class="store-info">
            <h2>Il TUO Salmoiraghi & Viganò di Cesano</h2>
            
            <div class="info-row">
                <div class="info-icon">📍</div>
                <div class="info-text">
                    <div class="info-label">Indirizzo</div>
                    <div class="info-value">
                        <a href="https://maps.app.goo.gl/ukcJy7yEZZPEuH4v6" target="_blank" onclick="trackMapsClick('store_info')">
                            Via Don Sturzo<br>
                            CC Le Porte di Milano<br>
                            20090 Cesano Boscone (MI)
                        </a>
                    </div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">📞</div>
                <div class="info-text">
                    <div class="info-label">Telefono</div>
                    <div class="info-value">
                        <a href="tel:+390245862417" onclick="trackPhoneClick('store_info')">02 4586 2417</a>
                    </div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">💬</div>
                <div class="info-text">
                    <div class="info-label">WhatsApp Business</div>
                    <div class="info-value">
                        <a href="https://wa.me/390245862417?text=Salve,%20vorrei%20informazioni" target="_blank" onclick="trackWhatsAppClick('store_info')">
                            Chat con noi
                        </a>
                    </div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">✉️</div>
                <div class="info-text">
                    <div class="info-label">Email</div>
                    <div class="info-value">
                        <a href="mailto:mi835@luxottica.com" onclick="trackEmailClick('store_info')">Invia email</a>
                    </div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">🕐</div>
                <div class="info-text">
                    <div class="info-label">Orari</div>
                    <div class="info-value">
                        Lun-Sab: 9:00 - 20:00<br>
                        Domenica: 10:00 - 20:00
                    </div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">📱</div>
                <div class="info-text">
                    <div class="info-label">Seguici su Instagram</div>
                    <div class="info-value">
                        <a href="https://www.instagram.com/salmoiraghievigano/" target="_blank" onclick="openSocialMedia()">
                            @salmoiraghievigano
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="reviews-section">
            <h2 style="font-family: 'Playfair Display', serif; text-align: center; margin-bottom: 30px;">Cosa dicono i clienti del nostro negozio di Cesano</h2>
            
            <div class="review-card">
                <div class="review-header">
                    <span class="review-author">Mariateresa C.</span>
                    <span class="review-rating">⭐⭐⭐⭐⭐</span>
                </div>
                <p class="review-text">"Sono cliente da diversi anni ed ogni volta rimango più che soddisfatta per l'alta professionalità dei tecnici e delle operatrici di servizio vendita. Congratulazioni vivissime!"</p>
                <span class="review-date">5 mesi fa</span>
            </div>

            <div class="review-card">
                <div class="review-header">
                    <span class="review-author">Gianluca B.</span>
                    <span class="review-rating">⭐⭐⭐⭐⭐</span>
                </div>
                <p class="review-text">"Sono stati molto competenti, gentili e mi hanno saputo consigliare al meglio sia dal punto di vista tecnico, medico, estetico e non ultimo finanziario. Visita optometrica molto accurata e precisa da 10 e lode."</p>
                <span class="review-date">1 anno fa</span>
            </div>

            <div class="review-card">
                <div class="review-header">
                    <span class="review-author">Ornella B.</span>
                    <span class="review-rating">⭐⭐⭐⭐⭐</span>
                </div>
                <p class="review-text">"Negozio molto fornito, montature per occhiali da vista belle a prezzi convenienti, occhiali da sole di tutte le marche. In 2 giorni hanno provveduto ad avvisarmi mandandomi un'email, sono soddisfatta."</p>
                <span class="review-date">7 mesi fa</span>
            </div>

            <div class="review-card">
                <div class="review-header">
                    <span class="review-author">Shani A.</span>
                    <span class="review-rating">⭐⭐⭐⭐⭐</span>
                </div>
                <p class="review-text">"La dipendente è stata molto disponibile, gentile ed efficiente. Domande chiare per capire le mie esigenze e i miei gusti. Gli occhiali acquistati sono bellissimi e di ottima qualità!"</p>
                <span class="review-date">2 anni fa</span>
            </div>

            <a href="https://share.google/kKyQCHvheXBI4EgKd" target="_blank" class="review-cta" onclick="trackReviewClick('review_cta')">
                ✍️ Lascia la tua recensione
            </a>
        </div>

        <!-- Guide Section -->
        <div style="padding: 0 20px; max-width: 1000px; margin: 40px auto 0;">
            <h2 style="font-family: 'Playfair Display', serif; text-align: center; margin-bottom: 30px; font-size: 28px; color: var(--midnight);">
                💡 Guide e Consigli Utili
            </h2>

            <div class="guide-card" onclick="toggleGuide(this)">
                <div class="guide-header">
                    <h3 class="guide-title">Come Pulire le Lenti</h3>
                    <span class="guide-icon">+</span>
                </div>
                <div class="guide-content">
                    <p class="guide-text">La pulizia corretta delle lenti è essenziale per mantenere una visione nitida e prolungare la vita dei tuoi occhiali.</p>
                    <div class="guide-tip">
                        <div class="guide-tip-title">💡 Procedura Corretta:</div>
                        <ol style="margin-left: 20px; color: var(--steel);">
                            <li>Sciacqua con acqua tiepida</li>
                            <li>Applica una goccia di sapone neutro</li>
                            <li>Strofina delicatamente con i polpastrelli</li>
                            <li>Risciacqua abbondantemente</li>
                            <li>Asciuga con panno in microfibra</li>
                        </ol>
                    </div>
                    <p class="guide-text" style="margin-top: 16px;">⚠️ <strong>Evita:</strong> tessuti ruvidi, carta, alcool, acetone</p>
                </div>
            </div>

            <div class="guide-card" onclick="toggleGuide(this)">
                <div class="guide-header">
                    <h3 class="guide-title">Scegliere la Montatura Giusta</h3>
                    <span class="guide-icon">+</span>
                </div>
                <div class="guide-content">
                    <p class="guide-text">La montatura perfetta valorizza il tuo viso e riflette la tua personalità.</p>
                    <div class="guide-tip">
                        <div class="guide-tip-title">👤 Per Forma del Viso:</div>
                        <ul style="margin-left: 20px; color: var(--steel);">
                            <li><strong>Ovale:</strong> Quasi tutte le forme</li>
                            <li><strong>Rotondo:</strong> Montature squadrate o rettangolari</li>
                            <li><strong>Quadrato:</strong> Forme tonde o ovali</li>
                            <li><strong>Triangolare:</strong> Cat-eye o montature larghe in alto</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="guide-card" onclick="toggleGuide(this)">
                <div class="guide-header">
                    <h3 class="guide-title">Protezione UV</h3>
                    <span class="guide-icon">+</span>
                </div>
                <div class="guide-content">
                    <p class="guide-text">La protezione dai raggi UV è fondamentale per la salute dei tuoi occhi.</p>
                    <div class="guide-tip">
                        <div class="guide-tip-title">🕶️ Cosa Cercare:</div>
                        <ul style="margin-left: 20px; color: var(--steel);">
                            <li>Protezione UV400 (blocca il 100% dei raggi UV)</li>
                            <li>Lenti polarizzate per ridurre i riflessi</li>
                            <li>Categoria 3 per sole intenso</li>
                            <li>Marchio CE per conformità europea</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="guide-card" onclick="toggleGuide(this)">
                <div class="guide-header">
                    <h3 class="guide-title">Manutenzione Occhiali</h3>
                    <span class="guide-icon">+</span>
                </div>
                <div class="guide-content">
                    <p class="guide-text">Una corretta manutenzione garantisce comfort e durata nel tempo.</p>
                    <div class="guide-tip">
                        <div class="guide-tip-title">🔧 Controlli Periodici:</div>
                        <ul style="margin-left: 20px; color: var(--steel);">
                            <li>Viti delle cerniere: stringere ogni 2 mesi</li>
                            <li>Naselli: pulire settimanalmente</li>
                            <li>Astine: verificare l'allineamento</li>
                            <li>Controllo professionale: ogni 6 mesi</li>
                        </ul>
                    </div>
                    <p class="guide-text" style="margin-top: 16px;">Passa in negozio per un controllo gratuito!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Cookie Banner -->
    <div class="cookie-banner" id="cookie-banner">
        <div class="cookie-content">
            <h3 class="cookie-title">🍪 Rispettiamo la tua privacy</h3>
            <p class="cookie-text">
                Utilizziamo cookie essenziali per il funzionamento del sito e, solo con il tuo consenso, 
                cookie analitici per migliorare i nostri servizi. Nessun dato personale viene condiviso con terze parti.
            </p>
            <div class="cookie-buttons">
                <button class="cookie-btn accept" onclick="acceptCookies()">✅ Accetta tutto</button>
                <button class="cookie-btn customize" onclick="showPrivacySettings()">⚙️ Personalizza</button>
                <button class="cookie-btn reject" onclick="rejectCookies()">❌ Solo essenziali</button>
            </div>
        </div>
    </div>

    <!-- Privacy Settings Modal -->
    <div class="modal privacy-modal" id="privacy-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closePrivacyModal()">✕</button>
            <h2 style="font-family: 'Playfair Display', serif; text-align: center; margin-bottom: 30px;">⚙️ Impostazioni Privacy</h2>
            
            <div class="privacy-section">
                <h3>🔒 Cookie Essenziali</h3>
                <p>Necessari per il funzionamento base del sito (navigazione, sicurezza). Sempre attivi.</p>
                <div class="consent-toggle">
                    <div class="toggle-info">
                        <div class="toggle-title">Cookie Tecnici</div>
                        <div class="toggle-desc">Funzionalità base del sito</div>
                    </div>
                    <div class="toggle-switch">
                        <input type="checkbox" checked disabled>
                        <span class="toggle-slider"></span>
                    </div>
                </div>
            </div>
            
            <div class="privacy-section">
                <h3>📊 Cookie Analitici</h3>
                <p>Ci aiutano a capire come viene utilizzato il sito per migliorare i nostri servizi. Tutti i dati sono anonimi.</p>
                <div class="consent-toggle">
                    <div class="toggle-info">
                        <div class="toggle-title">Google Analytics</div>
                        <div class="toggle-desc">Statistiche anonime di utilizzo (IP anonimizzato)</div>
                    </div>
                    <div class="toggle-switch">
                        <input type="checkbox" id="analytics-toggle">
                        <span class="toggle-slider"></span>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="quick-btn" onclick="savePrivacySettings()" style="margin-right: 10px;">💾 Salva Preferenze</button>
                <button class="quick-btn secondary" onclick="closePrivacyModal()">❌ Annulla</button>
            </div>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--smoke); font-size: 12px; color: var(--steel); text-align: center;">
                📧 <strong>Domande?</strong> Contattaci: <a href="mailto:mi835@luxottica.com" style="color: var(--champagne);" onclick="trackEmailClick('privacy_modal')">mi835@luxottica.com</a><br>
                📄 Per maggiori informazioni consulta la <a href="#" onclick="showPrivacyPolicy()" style="color: var(--champagne);">Privacy Policy</a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-brand">Il TUO Salmoiraghi & Viganò</div>
            <p class="footer-text">
                L'eccellenza della vista dal 1865<br>
                <strong>La tua boutique di fiducia a Cesano Boscone</strong>
            </p>
            <p class="footer-text">
                <a href="https://maps.app.goo.gl/ukcJy7yEZZPEuH4v6" target="_blank" class="footer-link" onclick="trackMapsClick('footer')">
                    📍 Vieni a trovarci alle Porte di Milano
                </a>
            </p>
        </div>
    </footer>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#home" class="nav-item active" onclick="navigateTo('home'); return false;">
            <span class="nav-icon">🏠</span>
            <span class="nav-label">Home</span>
        </a>
        <a href="#catalogo" class="nav-item" onclick="navigateTo('catalogo'); return false;">
            <span class="nav-icon">🛒</span>
            <span class="nav-label">Catalogo</span>
        </a>
        <a href="#prenota" class="nav-item" onclick="navigateTo('prenota'); return false;">
            <span class="nav-icon">📅</span>
            <span class="nav-label">Prenota</span>
        </a>
        <a href="#giochi" class="nav-item" onclick="navigateTo('giochi'); return false;">
            <span class="nav-icon">🎮</span>
            <span class="nav-label">Giochi</span>
        </a>
        <a href="#negozio" class="nav-item" onclick="navigateTo('negozio'); return false;">
            <span class="nav-icon">🏪</span>
            <span class="nav-label">Info</span>
        </a>
    </nav>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">✕</button>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- Install Prompt -->
    <div class="install-prompt" id="install-prompt">
        <div class="install-content">
            <div class="install-text">
                <div class="install-title">Installa S&V App</div>
                <div class="install-desc">Accesso rapido alla tua boutique</div>
            </div>
            <div class="install-buttons">
                <button class="install-button primary" onclick="installApp()">Installa</button>
                <button class="install-button secondary" onclick="hideInstallPrompt()">Dopo</button>
            </div>
        </div>
    </div>

    <script>
        // ===== SISTEMA DI LOGGING AVANZATO =====
        const Logger = {
            log: function(message, data = {}) {
                console.log(`%c[S&V App] ${message}`, 'color: #d4af37; font-weight: bold;', data);
            },
            error: function(message, error = {}) {
                console.error(`%c[S&V Error] ${message}`, 'color: #e0115f; font-weight: bold;', error);
            },
            track: function(event, data = {}) {
                console.log(`%c[S&V Track] ${event}`, 'color: #50c878; font-weight: bold;', data);
            }
        };

        // ===== GESTIONE PRELOADER - SAFARI COMPATIBLE =====
        let preloaderHidden = false;
        
        function hidePreloader() {
            if (preloaderHidden) return;
            preloaderHidden = true;
            
            const preloader = document.getElementById('preloader');
            if (preloader) {
                Logger.log('Nascondendo preloader...');
                
                // Safari-friendly hiding
                preloader.classList.add('hidden');
                
                // Rimozione sicura - Safari needs shorter timeout
                setTimeout(() => {
                    if (preloader && preloader.parentNode) {
                        preloader.classList.add('remove');
                        preloader.style.display = 'none';
                    }
                    Logger.log('Preloader rimosso completamente');
                }, 350); // Ridotto per Safari
            }
        }

        // Safari-compatible initialization
        function initApp() {
            Logger.log('Inizializzazione app...');
            
            // Immediate fallback for Safari
            if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {
                Logger.log('Safari detected - preloader rapido');
                setTimeout(hidePreloader, 100);
            } else {
                setTimeout(hidePreloader, 500);
            }
        }

        // Multiple triggers ottimizzati per Safari
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }

        window.addEventListener('load', () => {
            Logger.log('Window caricata');
            setTimeout(hidePreloader, 100);
        });

        // Fallback assoluto ridotto per Safari
        setTimeout(() => {
            if (!preloaderHidden) {
                Logger.log('Fallback preloader attivato');
                hidePreloader();
            }
        }, 1500);

        // ===== SAFARI LOCALSTORAGE SAFE WRAPPER =====
        const SafeStorage = {
            setItem: function(key, value) {
                try {
                    localStorage.setItem(key, value);
                    return true;
                } catch (e) {
                    Logger.error('LocalStorage blocked (Safari private mode?):', e);
                    // Fallback to session-only storage
                    window['_tempStorage'] = window['_tempStorage'] || {};
                    window['_tempStorage'][key] = value;
                    return false;
                }
            },
            
            getItem: function(key) {
                try {
                    return localStorage.getItem(key);
                } catch (e) {
                    Logger.error('LocalStorage read blocked:', e);
                    return window['_tempStorage'] && window['_tempStorage'][key] || null;
                }
            }
        };

        // ===== ANALYTICS & PRIVACY MANAGEMENT - SAFARI SAFE =====
        let analyticsEnabled = false;
        
        function initPrivacy() {
            Logger.log('Inizializzazione privacy...');
            const consent = SafeStorage.getItem('cookie-consent');
            if (consent) {
                try {
                    const settings = JSON.parse(consent);
                    analyticsEnabled = settings.analytics;
                    Logger.log('Consenso esistente trovato', settings);
                    if (analyticsEnabled) {
                        enableAnalytics();
                    }
                } catch (e) {
                    Logger.error('Errore parsing consenso', e);
                }
            } else {
                setTimeout(() => {
                    Logger.log('Mostrando banner cookie');
                    const banner = document.getElementById('cookie-banner');
                    if (banner) banner.classList.add('show');
                }, 2000);
            }
        }
        
        function enableAnalytics() {
            Logger.log('Abilitando Google Analytics...');
            if (typeof gtag !== 'undefined') {
                gtag('consent', 'update', {
                    'analytics_storage': 'granted'
                });
                analyticsEnabled = true;
                Logger.log('Analytics abilitato');
            }
        }
        
        function disableAnalytics() {
            Logger.log('Disabilitando Google Analytics...');
            if (typeof gtag !== 'undefined') {
                gtag('consent', 'update', {
                    'analytics_storage': 'denied'
                });
                analyticsEnabled = false;
                Logger.log('Analytics disabilitato');
            }
        }
        
        // ===== COOKIE BANNER FUNCTIONS - SAFARI SAFE =====
        function acceptCookies() {
            const settings = { essential: true, analytics: true };
            SafeStorage.setItem('cookie-consent', JSON.stringify(settings));
            enableAnalytics();
            document.getElementById('cookie-banner').classList.remove('show');
            Logger.log('Cookie accettati', settings);
        }
        
        function rejectCookies() {
            const settings = { essential: true, analytics: false };
            SafeStorage.setItem('cookie-consent', JSON.stringify(settings));
            disableAnalytics();
            document.getElementById('cookie-banner').classList.remove('show');
            Logger.log('Cookie rifiutati', settings);
        }
        
        function showPrivacySettings() {
            document.getElementById('cookie-banner').classList.remove('show');
            const consent = SafeStorage.getItem('cookie-consent');
            if (consent) {
                try {
                    const settings = JSON.parse(consent);
                    const toggle = document.getElementById('analytics-toggle');
                    if (toggle) toggle.checked = settings.analytics;
                } catch (e) {
                    Logger.error('Errore lettura consenso per settings', e);
                }
            }
            document.getElementById('privacy-modal').classList.add('active');
        }
        
        function closePrivacyModal() {
            document.getElementById('privacy-modal').classList.remove('active');
            if (!SafeStorage.getItem('cookie-consent')) {
                setTimeout(() => {
                    document.getElementById('cookie-banner').classList.add('show');
                }, 500);
            }
        }
        
        function savePrivacySettings() {
            const analyticsToggle = document.getElementById('analytics-toggle');
            const analytics = analyticsToggle ? analyticsToggle.checked : false;
            const settings = { essential: true, analytics };
            
            SafeStorage.setItem('cookie-consent', JSON.stringify(settings));
            
            if (analytics) {
                enableAnalytics();
            } else {
                disableAnalytics();
            }
            
            document.getElementById('privacy-modal').classList.remove('active');
            Logger.log('Impostazioni privacy salvate', settings);
        }
        
        function showPrivacyPolicy() {
            const policyContent = `
                <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 20px;">📄 Informativa Privacy</h2>
                <div style="text-align: left; max-height: 400px; overflow-y: auto; padding-right: 10px;">
                    <h3>🍪 Cookie utilizzati</h3>
                    <p><strong>Cookie Essenziali:</strong> Necessari per il funzionamento del sito (sessione, sicurezza, preferenze).</p>
                    <p><strong>Google Analytics:</strong> Raccoglie dati anonimi sull'utilizzo del sito (con IP anonimizzato).</p>
                    
                    <h3>📊 Dati raccolti</h3>
                    <p>• Pagine visitate e tempo di permanenza<br>
                    • Dispositivo utilizzato (mobile/desktop)<br>
                    • Azioni specifiche: scansioni QR, contatti WhatsApp<br>
                    • Nessun dato personale identificabile</p>
                    
                    <h3>🎯 Finalità</h3>
                    <p>I dati servono esclusivamente per migliorare l'esperienza utente e ottimizzare i servizi della boutique.</p>
                    
                    <h3>📧 Contatti</h3>
                    <p>Per domande sulla privacy: <a href="mailto:mi835@luxottica.com" style="color: var(--champagne);" onclick="trackEmailClick('privacy_policy')">mi835@luxottica.com</a></p>
                </div>
            `;
            showModal('', '', policyContent + '<button class="quick-btn" onclick="closeModal()" style="margin-top: 20px; width: 100%;">Chiudi</button>');
        }

        // ===== ENHANCED EVENT TRACKING =====
        function trackEvent(eventName, eventData = {}) {
            Logger.track(eventName, eventData);
            
            if (analyticsEnabled && typeof gtag !== 'undefined') {
                try {
                    gtag('event', eventName, {
                        'event_category': eventData.category || 'engagement',
                        'event_label': eventData.label || '',
                        'value': eventData.value || 1,
                        'custom_parameter': eventData,
                        'send_to': 'G-LX1EQS2ESC'
                    });
                    Logger.log('Evento GA inviato', { eventName, eventData });
                } catch (e) {
                    Logger.error('Errore invio evento GA', e);
                }
            }
        }
        
        // ===== CONTACT TRACKING FUNCTIONS =====
        function trackPhoneClick(source = 'generic') {
            trackEvent('phone_click', {
                category: 'conversion',
                label: source,
                source: source,
                phone_number: '+390245862417'
            });
        }
        
        function trackWhatsAppClick(source = 'generic') {
            trackEvent('whatsapp_click', {
                category: 'conversion', 
                label: source,
                source: source,
                whatsapp_number: '390245862417'
            });
        }
        
        function trackEmailClick(source = 'generic') {
            trackEvent('email_click', {
                category: 'conversion',
                label: source,
                source: source,
                email: 'mi835@luxottica.com'
            });
        }
        
        function trackMapsClick(source = 'generic') {
            trackEvent('maps_click', {
                category: 'engagement',
                label: source,
                source: source,
                maps_url: 'https://maps.app.goo.gl/ukcJy7yEZZPEuH4v6'
            });
        }
        
        function trackReviewClick(source = 'generic') {
            trackEvent('review_click', {
                category: 'engagement',
                label: source,
                source: source,
                review_url: 'https://share.google/kKyQCHvheXBI4EgKd'
            });
        }

        function trackQRScan() {
            trackEvent('qr_scan', {
                category: 'engagement',
                label: 'qr_code_scan',
                value: 1
            });
        }

        // ===== PAGE NAVIGATION =====
        const pages = {
            'home': 'home-page',
            'prenota': 'prenota-page', 
            'clubete': 'clubete-page',
            'catalogo': 'catalogo-page',
            'riordini': 'riordini-page',
            'styleadvisor': 'styleadvisor-page',
            'giochi': 'giochi-page',
            'negozio': 'negozio-page'
        };

        function navigateTo(pageName) {
            Logger.log('Navigazione verso:', pageName);
            
            // Track page view
            trackEvent('page_view', {
                category: 'navigation',
                label: pageName,
                page: pageName
            });
            
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            const pageId = pages[pageName];
            if (pageId) {
                document.getElementById(pageId).classList.add('active');
            }
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + pageName) {
                    item.classList.add('active');
                }
            });
            
            window.scrollTo(0, 0);
        }

        // ===== EXTERNAL LINKS FUNCTIONS =====
        function openMaps() {
            trackMapsClick('service_card');
            window.open('https://maps.app.goo.gl/ukcJy7yEZZPEuH4v6', '_blank');
        }
        
        function openGoogleReviews() {
            trackReviewClick('service_card');
            window.open('https://share.google/kKyQCHvheXBI4EgKd', '_blank');
        }

        function openCatalog(category) {
            let url = 'https://www.salmoiraghievigano.it/';
            let trackingLabel = 'catalog_' + category;
            
            switch(category) {
                case 'vista':
                    url = 'https://www.salmoiraghievigano.it/occhiali-da-vista';
                    break;
                case 'sole':
                    url = 'https://www.salmoiraghievigano.it/occhiali-da-sole';
                    break;
                case 'lac':
                    url = 'https://www.salmoiraghievigano.it/lenti-a-contatto';
                    break;
                case 'accessori':
                    url = 'https://www.salmoiraghievigano.it/';
                    trackingLabel = 'catalog_accessories';
                    break;
            }
            
            trackEvent('catalog_click', {
                category: 'engagement',
                label: trackingLabel,
                source: 'catalog_page',
                category_type: category,
                destination_url: url
            });
            
            window.open(url, '_blank');
        }

        function openSocialMedia() {
            trackEvent('social_click', {
                category: 'engagement',
                label: 'instagram_official',
                source: 'social_section'
            });
            window.open('https://www.instagram.com/salmoiraghievigano/', '_blank');
        }

        // ===== COUNTDOWN TIMER =====
        function updateTimer() {
            const endTime = new Date();
            endTime.setHours(23, 59, 59, 999);
            
            const now = new Date();
            const diff = endTime - now;
            
            if (diff <= 0) {
                endTime.setDate(endTime.getDate() + 1);
                endTime.setHours(23, 59, 59, 999);
                diff = endTime - now;
            }
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            const hoursEl = document.getElementById('timer-hours');
            const minutesEl = document.getElementById('timer-minutes');
            const secondsEl = document.getElementById('timer-seconds');
            
            if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
            if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
            if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
        }
        
        setInterval(updateTimer, 1000);
        updateTimer();

        // ===== APPOINTMENT BOOKING =====
        function bookAppointment(service) {
            trackWhatsAppClick('appointment_' + service.toLowerCase().replace(/\s+/g, '_'));
            const message = `Salve, vorrei prenotare: ${service}`;
            const phoneNumber = '390245862417';
            const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            
            // Additional tracking for appointment type
            trackEvent('appointment_request', {
                category: 'conversion',
                label: service,
                service_type: service
            });
            
            window.open(url, '_blank');
        }

        // ===== GUIDE TOGGLE =====
        function toggleGuide(card) {
            const content = card.querySelector('.guide-content');
            const icon = card.querySelector('.guide-icon');
            const title = card.querySelector('.guide-title').textContent;
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                icon.textContent = '+';
                
                trackEvent('guide_closed', {
                    category: 'engagement',
                    label: title,
                    guide_title: title
                });
            } else {
                document.querySelectorAll('.guide-content').forEach(c => {
                    c.classList.remove('active');
                });
                document.querySelectorAll('.guide-icon').forEach(i => {
                    i.textContent = '+';
                });
                
                content.classList.add('active');
                icon.textContent = '−';
                
                trackEvent('guide_opened', {
                    category: 'engagement',
                    label: title,
                    guide_title: title
                });
            }
        }

        // ===== GAME SYSTEM - SAFARI COMPATIBLE =====
        let hasWonToday = SafeStorage.getItem('gameWinToday') === new Date().toDateString();
        let currentGame = null;
        
        // Prize system with exact percentages
        const prizes = [
            { name: '50% occhiale da vista', code: 'VISTA50', weight: 5, condition: 'Minima spesa pre-sconto €50' },
            { name: '€50 extra sconto vista', code: 'EXTRA50', weight: 15, condition: 'Su qualsiasi montatura' },
            { name: '25% su due confezioni LAC', code: 'LAC25', weight: 20, condition: 'Valido su tutte le marche' },
            { name: '20% occhiale da sole', code: 'SOLE20', weight: 60, condition: 'Su tutta la collezione' }
        ];
        
        function canWinToday() {
            const today = new Date().toDateString();
            return SafeStorage.getItem('gameWinToday') !== today;
        }
        
        function selectPrize() {
            const totalWeight = prizes.reduce((sum, prize) => sum + prize.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (let prize of prizes) {
                random -= prize.weight;
                if (random <= 0) {
                    return prize;
                }
            }
            return prizes[prizes.length - 1];
        }
        
        function playGame(gameType) {
            if (!canWinToday() && Math.random() < 0.3) {
                showModal('⏰', 'Hai già vinto oggi!', 
                    `Hai già vinto un premio oggi. Puoi continuare a giocare per divertirti, ma per vincere altri premi torna domani!<br><br>
                    <button class="quick-btn" onclick="closeModal(); startGame('${gameType}');" style="margin-top: 15px;">🎮 Gioca lo stesso!</button>`
                );
                return;
            }
            
            startGame(gameType);
        }
        
        function startGame(gameType) {
            currentGame = gameType;
            
            switch(gameType) {
                case 'wheel':
                    showWheelGame();
                    break;
                case 'eyetest':
                    showEyeTestGame();
                    break;
                case 'brandquiz':
                    showBrandQuizGame();
                    break;
                case 'optician':
                    showOpticianQuizGame();
                    break;
                case 'creator':
                    showCreatorGame();
                    break;
                case 'memory':
                    showMemoryGame();
                    break;
            }
            
            trackEvent('game_started', {
                category: 'engagement',
                label: gameType,
                game_type: gameType,
                can_win_today: canWinToday()
            });
        }
        
        function completeGame(gameType, success = true) {
            if (!success) {
                showModal('😔', 'Riprova!', 
                    `Non sei riuscito a completare il gioco, ma puoi riprovare subito!<br><br>
                    <button class="quick-btn" onclick="closeModal(); startGame('${gameType}');" style="margin-top: 15px;">🔄 Riprova</button>`
                );
                return;
            }
            
            if (canWinToday()) {
                const prize = selectPrize();
                const code = 'SV' + Date.now().toString().slice(-6);
                
                showModal('🎉', 'Congratulazioni!', 
                    `<p style="font-size: 20px; margin: 20px 0;">Hai vinto:<br><strong>${prize.name}</strong></p>
                    <div style="background: var(--silk); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <p style="font-family: monospace; font-size: 24px; letter-spacing: 3px; color: var(--midnight);">${code}</p>
                        <p style="font-size: 12px; color: var(--steel); margin-top: 8px;">${prize.condition}</p>
                    </div>
                    <p style="color: var(--steel); font-size: 14px;">Mostra questo codice in negozio<br>Valido per 7 giorni</p>
                    <a href="https://wa.me/390245862417?text=Ho%20vinto%20il%20codice%20${code}%20per%20${encodeURIComponent(prize.name)}" target="_blank" class="quick-btn" style="margin-top: 20px;" onclick="trackWhatsAppClick('game_winner')">💬 Invia su WhatsApp</a>`
                );
                
                SafeStorage.setItem('gameWinToday', new Date().toDateString());
                hasWonToday = true;
                
                trackEvent('game_won', {
                    category: 'conversion',
                    label: gameType,
                    game_type: gameType,
                    prize: prize.name,
                    code: code
                });
            } else {
                showModal('👏', 'Ben giocato!', 
                    `Ottima performance! Hai già vinto oggi, ma continua a giocare per divertirti.<br><br>
                    <p style="color: var(--steel); font-size: 14px; margin-top: 16px;">Torna domani per vincere altri premi!</p>`
                );
                
                trackEvent('game_completed_no_win', {
                    category: 'engagement',
                    label: gameType,
                    game_type: gameType
                });
            }
        }
        
        // ===== WHEEL GAME =====
        function showWheelGame() {
            const wheelHTML = `
                <div style="background: white; border-radius: 20px; padding: 30px; text-align: center; box-shadow: 0 20px 60px var(--shadow);">
                    <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 20px; color: var(--midnight);">🎡 Ruota della Fortuna</h2>
                    
                    <div style="position: relative; width: 280px; height: 280px; margin: 0 auto 30px;">
                        <div style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 40px solid var(--champagne); filter: drop-shadow(0 3px 10px rgba(0, 0, 0, 0.3)); z-index: 11;"></div>
                        
                        <div id="game-wheel" style="width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(from 0deg, var(--champagne) 0deg 60deg, var(--midnight) 60deg 120deg, var(--champagne) 120deg 180deg, var(--midnight) 180deg 240deg, var(--champagne) 240deg 300deg, var(--midnight) 300deg 360deg); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99); position: relative;">
                            
                            <div style="position: absolute; top: 10%; left: 50%; transform: translateX(-50%) rotate(0deg); color: white; font-size: 11px; font-weight: 700; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);">SOLE 20%</div>
                            <div style="position: absolute; top: 25%; right: 15%; transform: rotate(60deg); color: white; font-size: 11px; font-weight: 700; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);">LAC 25%</div>
                            <div style="position: absolute; bottom: 25%; right: 15%; transform: rotate(120deg); color: white; font-size: 11px; font-weight: 700; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);">€50 EXTRA</div>
                            <div style="position: absolute; bottom: 10%; left: 50%; transform: translateX(-50%) rotate(180deg); color: white; font-size: 11px; font-weight: 700; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);">RIPROVA</div>
                            <div style="position: absolute; bottom: 25%; left: 15%; transform: rotate(240deg); color: white; font-size: 11px; font-weight: 700; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);">VISTA 50%</div>
                            <div style="position: absolute; top: 25%; left: 15%; transform: rotate(300deg); color: white; font-size: 11px; font-weight: 700; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);">RIPROVA</div>
                            
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Playfair Display', serif; font-size: 24px; color: var(--midnight); z-index: 10; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);">S&V</div>
                        </div>
                    </div>
                    
                    <button class="quick-btn" onclick="spinGameWheel()" style="width: 100%; font-size: 16px; padding: 18px;" id="spin-game-btn">🎡 GIRA LA RUOTA</button>
                    <button class="quick-btn secondary" onclick="closeGameModal()" style="width: 100%; margin-top: 10px;">🔙 Torna ai Giochi</button>
                </div>
            `;
            
            showModal('', '', wheelHTML);
        }
        
        let gameWheelRotation = 0;
        function spinGameWheel() {
            const wheel = document.getElementById('game-wheel');
            const button = document.getElementById('spin-game-btn');
            
            if (!wheel || button.disabled) return;
            
            button.disabled = true;
            button.textContent = 'GIRANDO...';
            
            const spins = 5 + Math.random() * 3;
            const finalAngle = Math.random() * 360;
            const totalRotation = gameWheelRotation + (spins * 360) + finalAngle;
            
            wheel.style.transform = `rotate(${totalRotation}deg)`;
            gameWheelRotation = totalRotation % 360;
            
            setTimeout(() => {
                button.disabled = false;
                button.textContent = '🎡 GIRA LA RUOTA';
                closeGameModal();
                completeGame('wheel', true);
            }, 4000);
        }
        
        // ===== EYE TEST GAME =====
        function showEyeTestGame() {
            const letters = ['E', 'F', 'P', 'T', 'O', 'Z', 'L', 'P', 'E', 'D'];
            let currentLevel = 0;
            const maxLevels = 5;
            
            showEyeTestLevel(currentLevel, letters, maxLevels);
        }
        
        function showEyeTestLevel(level, letters, maxLevels) {
            const fontSize = 120 - (level * 20);
            const currentLetter = letters[Math.floor(Math.random() * letters.length)];
            
            const eyeTestHTML = `
                <div style="background: white; border-radius: 20px; padding: 40px; text-align: center; box-shadow: 0 20px 60px var(--shadow); max-width: 500px;">
                    <h2 style="font-family: 'Playfair Display', serif; font-size: 24px; margin-bottom: 20px; color: var(--midnight);">👁️ Test della Vista</h2>
                    
                    <div style="background: var(--silk); padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                        <p style="color: var(--steel); margin-bottom: 20px;">Livello ${level + 1}/${maxLevels}</p>
                        <div style="font-family: monospace; font-size: ${fontSize}px; font-weight: bold; color: var(--midnight); margin: 20px 0; line-height: 1;">${currentLetter}</div>
                        <p style="color: var(--steel); font-size: 14px;">Quale lettera vedi?</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                        <button class="quick-btn secondary" onclick="answerEyeTest('${currentLetter}', ${level}, ${maxLevels}, true)" style="font-size: 20px; padding: 15px;">${currentLetter}</button>
                        <button class="quick-btn secondary" onclick="answerEyeTest('${currentLetter}', ${level}, ${maxLevels}, false)" style="font-size: 20px; padding: 15px;">${letters[Math.floor(Math.random() * letters.length)]}</button>
                        <button class="quick-btn secondary" onclick="answerEyeTest('${currentLetter}', ${level}, ${maxLevels}, false)" style="font-size: 20px; padding: 15px;">${letters[Math.floor(Math.random() * letters.length)]}</button>
                        <button class="quick-btn secondary" onclick="answerEyeTest('${currentLetter}', ${level}, ${maxLevels}, false)" style="font-size: 20px; padding: 15px;">${letters[Math.floor(Math.random() * letters.length)]}</button>
                    </div>
                    
                    <button class="quick-btn secondary" onclick="closeGameModal()" style="width: 100%;">🔙 Torna ai Giochi</button>
                </div>
            `;
            
            showModal('', '', eyeTestHTML);
        }
        
        function answerEyeTest(correct, level, maxLevels, isCorrect) {
            if (!isCorrect) {
                completeGame('eyetest', false);
                return;
            }
            
            if (level + 1 >= maxLevels) {
                closeGameModal();
                completeGame('eyetest', true);
            } else {
                const letters = ['E', 'F', 'P', 'T', 'O', 'Z', 'L', 'P', 'E', 'D'];
                showEyeTestLevel(level + 1, letters, maxLevels);
            }
        }
        
        // ===== BRAND QUIZ GAME =====
        function showBrandQuizGame() {
            const brands = [
                { name: 'Ray-Ban', hint: 'Aviator, Wayfarer' },
                { name: 'Oakley', hint: 'Sport, prestazioni' },
                { name: 'Prada', hint: 'Lusso italiano' },
                { name: 'Versace', hint: 'Glamour, Medusa' },
                { name: 'Persol', hint: 'Tradizione italiana' },
                { name: 'Dolce & Gabbana', hint: 'Stile siciliano' }
            ];
            
            showBrandQuestion(0, brands, 0);
        }
        
        function showBrandQuestion(questionIndex, brands, score) {
            if (questionIndex >= 3) {
                closeGameModal();
                completeGame('brandquiz', score >= 2);
                return;
            }
            
            const currentBrand = brands[questionIndex];
            const otherBrands = brands.filter((_, i) => i !== questionIndex);
            const options = [currentBrand, ...otherBrands.slice(0, 2)].sort(() => Math.random() - 0.5);
            
            const brandQuizHTML = `
                <div style="background: white; border-radius: 20px; padding: 40px; text-align: center; box-shadow: 0 20px 60px var(--shadow); max-width: 500px;">
                    <h2 style="font-family: 'Playfair Display', serif; font-size: 24px; margin-bottom: 20px; color: var(--midnight);">🕶️ Indovina il Brand</h2>
                    
                    <div style="background: var(--silk); padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                        <p style="color: var(--steel); margin-bottom: 10px;">Domanda ${questionIndex + 1}/3 - Punteggio: ${score}</p>
                        <div style="font-size: 48px; margin: 20px 0;">🕶️</div>
                        <p style="color: var(--midnight); font-size: 18px; font-weight: 600; margin-bottom: 10px;">Indizio: ${currentBrand.hint}</p>
                        <p style="color: var(--steel); font-size: 14px;">Quale brand è?</p>
                    </div>
                    
                    <div style="display: grid; gap: 10px; margin-bottom: 20px;">
                        ${options.map(option => `
                            <button class="quick-btn secondary" onclick="answerBrandQuiz('${currentBrand.name}', '${option.name}', ${questionIndex}, ${score})" style="padding: 15px;">${option.name}</button>
                        `).join('')}
                    </div>
                    
                    <button class="quick-btn secondary" onclick="closeGameModal()" style="width: 100%;">🔙 Torna ai Giochi</button>
                </div>
            `;
            
            showModal('', '', brandQuizHTML);
        }
        
        function answerBrandQuiz(correct, answer, questionIndex, score) {
            const newScore = answer === correct ? score + 1 : score;
            const brands = [
                { name: 'Ray-Ban', hint: 'Aviator, Wayfarer' },
                { name: 'Oakley', hint: 'Sport, prestazioni' },
                { name: 'Prada', hint: 'Lusso italiano' },
                { name: 'Versace', hint: 'Glamour, Medusa' },
                { name: 'Persol', hint: 'Tradizione italiana' },
                { name: 'Dolce & Gabbana', hint: 'Stile siciliano' }
            ];
            
            showBrandQuestion(questionIndex + 1, brands, newScore);
        }
        
        // ===== SIMPLIFIED GAMES FOR SPACE =====
        function showOpticianQuizGame() {
            const questions = [
                { q: 'In che anno è nata Salmoiraghi & Viganò?', a: '1865', options: ['1865', '1880', '1900', '1920'] },
                { q: 'Cosa significa UV400?', a: 'Blocca 100% raggi UV', options: ['Blocca 100% raggi UV', 'Tipo di lente', 'Marca', 'Colore'] },
                { q: 'Quanto spesso controllare la vista?', a: 'Ogni 2 anni', options: ['Ogni anno', 'Ogni 2 anni', 'Ogni 5 anni', 'Mai'] }
            ];
            
            showQuizQuestion(0, questions, 0, 'optician');
        }
        
        function showCreatorGame() {
            const creatorHTML = `
                <div style="background: white; border-radius: 20px; padding: 40px; text-align: center; box-shadow: 0 20px 60px var(--shadow); max-width: 500px;">
                    <h2 style="font-family: 'Playfair Display', serif; font-size: 24px; margin-bottom: 20px; color: var(--midnight);">🎨 Crea il Tuo Occhiale</h2>
                    
                    <div style="background: var(--silk); padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                        <div style="font-size: 80px; margin: 20px 0;" id="preview-glasses">👓</div>
                        <p style="color: var(--steel); margin-bottom: 20px;">Personalizza il tuo stile</p>
                        
                        <div style="display: grid; gap: 10px;">
                            <button class="quick-btn secondary" onclick="changeGlasses('🕶️')" style="padding: 10px;">🕶️ Sole</button>
                            <button class="quick-btn secondary" onclick="changeGlasses('👓')" style="padding: 10px;">👓 Vista</button>
                            <button class="quick-btn secondary" onclick="changeGlasses('🥽')" style="padding: 10px;">🥽 Sport</button>
                        </div>
                    </div>
                    
                    <button class="quick-btn" onclick="closeGameModal(); completeGame('creator', true);" style="width: 100%; margin-bottom: 10px;">✨ Salva Creazione</button>
                    <button class="quick-btn secondary" onclick="closeGameModal()" style="width: 100%;">🔙 Torna ai Giochi</button>
                </div>
            `;
            
            showModal('', '', creatorHTML);
        }
        
        function changeGlasses(emoji) {
            const preview = document.getElementById('preview-glasses');
            if (preview) preview.textContent = emoji;
        }
        
        function showMemoryGame() {
            const memoryHTML = `
                <div style="background: white; border-radius: 20px; padding: 40px; text-align: center; box-shadow: 0 20px 60px var(--shadow); max-width: 500px;">
                    <h2 style="font-family: 'Playfair Display', serif; font-size: 24px; margin-bottom: 20px; color: var(--midnight);">🃏 Memory Montature</h2>
                    
                    <div style="background: var(--silk); padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                        <p style="color: var(--steel); margin-bottom: 20px;">Trova le coppie uguali</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; max-width: 200px; margin: 0 auto;" id="memory-grid">
                            ${Array(8).fill(0).map((_, i) => `
                                <div style="background: var(--champagne); color: white; width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 20px;" onclick="flipCard(${i})">?</div>
                            `).join('')}
                        </div>
                        
                        <p style="color: var(--steel); font-size: 14px; margin-top: 15px;">Coppie trovate: <span id="pairs-found">0</span>/4</p>
                    </div>
                    
                    <button class="quick-btn secondary" onclick="closeGameModal()" style="width: 100%;">🔙 Torna ai Giochi</button>
                </div>
            `;
            
            showModal('', '', memoryHTML);
            initMemoryGame();
        }
        
        let memoryCards = [];
        let memoryFlipped = [];
        let memoryMatched = [];
        
        function initMemoryGame() {
            const symbols = ['👓', '🕶️', '👁️', '🔍'];
            memoryCards = [...symbols, ...symbols].sort(() => Math.random() - 0.5);
            memoryFlipped = [];
            memoryMatched = [];
        }
        
        function flipCard(index) {
            if (memoryFlipped.length >= 2 || memoryFlipped.includes(index) || memoryMatched.includes(index)) return;
            
            const cards = document.querySelectorAll('#memory-grid div');
            cards[index].textContent = memoryCards[index];
            memoryFlipped.push(index);
            
            if (memoryFlipped.length === 2) {
                setTimeout(() => {
                    if (memoryCards[memoryFlipped[0]] === memoryCards[memoryFlipped[1]]) {
                        memoryMatched.push(...memoryFlipped);
                        document.getElementById('pairs-found').textContent = memoryMatched.length / 2;
                        
                        if (memoryMatched.length === 8) {
                            setTimeout(() => {
                                closeGameModal();
                                completeGame('memory', true);
                            }, 500);
                        }
                    } else {
                        memoryFlipped.forEach(i => {
                            cards[i].textContent = '?';
                        });
                    }
                    memoryFlipped = [];
                }, 1000);
            }
        }
        
        function showQuizQuestion(questionIndex, questions, score, gameType) {
            if (questionIndex >= questions.length) {
                closeGameModal();
                completeGame(gameType, score >= 2);
                return;
            }
            
            const question = questions[questionIndex];
            const shuffledOptions = [...question.options].sort(() => Math.random() - 0.5);
            
            const quizHTML = `
                <div style="background: white; border-radius: 20px; padding: 40px; text-align: center; box-shadow: 0 20px 60px var(--shadow); max-width: 500px;">
                    <h2 style="font-family: 'Playfair Display', serif; font-size: 24px; margin-bottom: 20px; color: var(--midnight);">🧠 Quiz dell'Ottico</h2>
                    
                    <div style="background: var(--silk); padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                        <p style="color: var(--steel); margin-bottom: 20px;">Domanda ${questionIndex + 1}/${questions.length} - Punteggio: ${score}</p>
                        <p style="color: var(--midnight); font-size: 18px; font-weight: 600; margin-bottom: 20px;">${question.q}</p>
                    </div>
                    
                    <div style="display: grid; gap: 10px; margin-bottom: 20px;">
                        ${shuffledOptions.map(option => `
                            <button class="quick-btn secondary" onclick="answerQuiz('${question.a}', '${option}', ${questionIndex}, ${score}, '${gameType}')" style="padding: 15px; font-size: 14px;">${option}</button>
                        `).join('')}
                    </div>
                    
                    <button class="quick-btn secondary" onclick="closeGameModal()" style="width: 100%;">🔙 Torna ai Giochi</button>
                </div>
            `;
            
            showModal('', '', quizHTML);
        }
        
        function answerQuiz(correct, answer, questionIndex, score, gameType) {
            const newScore = answer === correct ? score + 1 : score;
            
            const questions = gameType === 'optician' ? [
                { q: 'In che anno è nata Salmoiraghi & Viganò?', a: '1865', options: ['1865', '1880', '1900', '1920'] },
                { q: 'Cosa significa UV400?', a: 'Blocca 100% raggi UV', options: ['Blocca 100% raggi UV', 'Tipo di lente', 'Marca', 'Colore'] },
                { q: 'Quanto spesso controllare la vista?', a: 'Ogni 2 anni', options: ['Ogni anno', 'Ogni 2 anni', 'Ogni 5 anni', 'Mai'] }
            ] : [];
            
            showQuizQuestion(questionIndex + 1, questions, newScore, gameType);
        }
        
        function closeGameModal() {
            closeModal();
        }

        // ===== STYLE ADVISOR SYSTEM =====
        let styleTestData = {};
        let currentQuestion = 0;
        
        const styleQuestions = [
            {
                id: 'face_shape',
                question: 'Quale forma descrive meglio il tuo viso?',
                emoji: '👤',
                hint: 'Osservati allo specchio o chiedi a un amico',
                options: [
                    { value: 'oval', label: 'Ovale', description: 'Fronte e mascella equilibrate' },
                    { value: 'round', label: 'Rotondo', description: 'Viso morbido, larghezza = altezza' },
                    { value: 'square', label: 'Quadrato', description: 'Mascella pronunciata, angoli netti' },
                    { value: 'heart', label: 'A cuore', description: 'Fronte ampia, mento a punta' },
                    { value: 'long', label: 'Allungato', description: 'Altezza maggiore della larghezza' }
                ]
            },
            {
                id: 'skin_tone',
                question: 'Che sottotono ha la tua pelle?',
                emoji: '🌈',
                hint: 'Guarda le vene del polso: blu/viola = freddo, verde = caldo',
                options: [
                    { value: 'cool', label: 'Sottotono Freddo', description: 'Vene bluastre, sta bene argento' },
                    { value: 'warm', label: 'Sottotono Caldo', description: 'Vene verdastre, sta bene oro' },
                    { value: 'neutral', label: 'Neutro', description: 'Vene blu-verdi, sta bene tutto' }
                ]
            },
            {
                id: 'hair_color',
                question: 'Qual è il tuo colore di capelli naturale?',
                emoji: '💇‍♀️',
                hint: 'Considera il colore naturale, non tinto',
                options: [
                    { value: 'blonde', label: 'Biondo', description: 'Dal platino al biondo scuro' },
                    { value: 'brown', label: 'Castano', description: 'Dal castano chiaro al cioccolato' },
                    { value: 'black', label: 'Nero/Bruno', description: 'Capelli scuri intensi' },
                    { value: 'red', label: 'Rosso/Ramato', description: 'Riflessi rossi o ramati' },
                    { value: 'grey', label: 'Grigio/Sale-pepe', description: 'Capelli canuti o brizzolati' }
                ]
            },
            {
                id: 'style_preference',
                question: 'Quale stile rappresenta meglio la tua personalità?',
                emoji: '✨',
                hint: 'Pensa al tuo guardaroba e al tuo lifestyle',
                options: [
                    { value: 'classic', label: 'Classico Elegante', description: 'Linee pulite, stile senza tempo' },
                    { value: 'trendy', label: 'Trendy Moderno', description: 'Al passo con le tendenze' },
                    { value: 'bold', label: 'Audace Statement', description: 'Colori vivaci, forme particolari' },
                    { value: 'minimal', label: 'Minimalista Chic', description: 'Essenziale, discreto, raffinato' },
                    { value: 'artistic', label: 'Creativo Artistico', description: 'Originale, espressivo, unico' }
                ]
            }
        ];

        function startStyleTest() {
            styleTestData = {};
            currentQuestion = 0;
            
            document.getElementById('test-intro').style.display = 'none';
            document.getElementById('test-questions').style.display = 'block';
            
            showStyleQuestion(currentQuestion);
            
            trackEvent('style_test_started', {
                category: 'engagement',
                label: 'style_advisor_test'
            });
        }

        function showStyleQuestion(questionIndex) {
            const question = styleQuestions[questionIndex];
            const totalQuestions = styleQuestions.length;
            
            const progressPercentage = ((questionIndex + 1) / totalQuestions) * 100;
            
            const questionHTML = `
                <div style="background: white; border-radius: 20px; padding: 40px; box-shadow: 0 10px 40px var(--shadow);">
                    <!-- Progress Bar -->
                    <div style="background: #e9ecef; height: 6px; border-radius: 3px; margin-bottom: 30px; overflow: hidden;">
                        <div style="background: linear-gradient(90deg, #4ecdc4, #44a08d); height: 100%; width: ${progressPercentage}%; transition: width 0.5s ease;"></div>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="font-size: 64px; margin-bottom: 15px;">${question.emoji}</div>
                        <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 10px; color: var(--midnight);">
                            ${question.question}
                        </h2>
                        <p style="color: var(--steel); font-size: 14px; font-style: italic;">
                            💡 ${question.hint}
                        </p>
                        <div style="color: #4ecdc4; font-weight: 600; margin-top: 15px;">
                            Domanda ${questionIndex + 1} di ${totalQuestions}
                        </div>
                    </div>

                    <div style="display: grid; gap: 15px; max-width: 500px; margin: 0 auto;">
                        ${question.options.map(option => `
                            <div onclick="selectStyleOption('${question.id}', '${option.value}', ${questionIndex})" 
                                 style="background: #f8f9fa; padding: 20px; border-radius: 15px; cursor: pointer; transition: all 0.3s; border: 2px solid transparent;"
                                 onmouseover="this.style.borderColor='#4ecdc4'; this.style.background='rgba(78, 205, 196, 0.05)'"
                                 onmouseout="this.style.borderColor='transparent'; this.style.background='#f8f9fa'">
                                <div style="font-weight: 600; color: var(--midnight); margin-bottom: 5px;">${option.label}</div>
                                <div style="font-size: 13px; color: var(--steel);">${option.description}</div>
                            </div>
                        `).join('')}
                    </div>

                    ${questionIndex > 0 ? `
                        <div style="text-align: center; margin-top: 30px;">
                            <button class="quick-btn secondary" onclick="showStyleQuestion(${questionIndex - 1})" style="font-size: 14px;">
                                ← Domanda Precedente
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('test-questions').innerHTML = questionHTML;
        }

        function selectStyleOption(questionId, value, questionIndex) {
            styleTestData[questionId] = value;
            
            if (questionIndex < styleQuestions.length - 1) {
                // Piccola animazione prima di passare alla prossima domanda
                setTimeout(() => {
                    showStyleQuestion(questionIndex + 1);
                }, 300);
            } else {
                // Test completato, mostra risultati
                setTimeout(() => {
                    showStyleResults();
                }, 500);
            }
        }

        function showStyleResults() {
            const result = calculateStyleResult(styleTestData);
            
            document.getElementById('test-questions').style.display = 'none';
            
            const resultsHTML = `
                <div style="background: white; border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 10px 40px var(--shadow);">
                    <div style="text-align: center; margin-bottom: 40px;">
                        <div style="font-size: 72px; margin-bottom: 20px;">${result.emoji}</div>
                        <h2 style="font-family: 'Playfair Display', serif; font-size: 36px; margin-bottom: 15px; color: var(--midnight);">
                            Il Tuo Profilo: <span style="color: #4ecdc4;">${result.title}</span>
                        </h2>
                        <p style="font-size: 18px; color: var(--steel); line-height: 1.6; margin-bottom: 25px;">
                            ${result.description}
                        </p>
                    </div>

                    <!-- Recommended Frame Shapes -->
                    <div style="background: linear-gradient(135deg, rgba(78, 205, 196, 0.05), rgba(78, 205, 196, 0.1)); border-radius: 15px; padding: 25px; margin-bottom: 30px;">
                        <h3 style="color: var(--midnight); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <span style="color: #4ecdc4;">👓</span> Forme di Montatura Ideali per Te
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            ${result.frameShapes.map(shape => `
                                <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                                    <div style="font-size: 32px; margin-bottom: 8px;">${shape.emoji}</div>
                                    <div style="font-weight: 600; color: var(--midnight); margin-bottom: 5px;">${shape.name}</div>
                                    <div style="font-size: 12px; color: var(--steel);">${shape.reason}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Recommended Colors -->
                    <div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.05), rgba(212, 175, 55, 0.1)); border-radius: 15px; padding: 25px; margin-bottom: 30px;">
                        <h3 style="color: var(--midnight); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <span style="color: var(--champagne);">🎨</span> Palette Colori che ti Valorizzano
                        </h3>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            ${result.colors.map(color => `
                                <div style="text-align: center;">
                                    <div style="width: 50px; height: 50px; background: ${color.hex}; border-radius: 50%; margin: 0 auto 8px; border: 3px solid white; box-shadow: 0 3px 10px rgba(0,0,0,0.2);"></div>
                                    <div style="font-size: 12px; color: var(--midnight); font-weight: 500;">${color.name}</div>
                                </div>
                            `).join('')}
                        </div>
                        <p style="text-align: center; color: var(--steel); font-size: 14px; margin-top: 15px;">
                            ${result.colorAdvice}
                        </p>
                    </div>

                    <!-- Brand Suggestions -->
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; margin-bottom: 30px;">
                        <h3 style="color: var(--midnight); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <span style="color: #4ecdc4;">⭐</span> Brand Consigliati
                        </h3>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            ${result.brands.map(brand => `
                                <div style="background: white; padding: 15px 20px; border-radius: 10px; text-align: center; border: 2px solid #e9ecef;">
                                    <div style="font-weight: 600; color: var(--midnight);">${brand}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <div style="background: linear-gradient(135deg, var(--midnight), #1a2c48); color: white; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
                            <h3 style="color: var(--champagne); margin-bottom: 15px; font-size: 22px;">
                                🎯 Il Prossimo Passo
                            </h3>
                            <p style="margin-bottom: 20px; opacity: 0.9; line-height: 1.5;">
                                Ora che conosci il tuo profilo, vieni da noi a <strong>Cesano Boscone</strong><br>
                                per una consulenza personalizzata con il nostro team di esperti!
                            </p>
                            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                                <a href="https://wa.me/390245862417?text=Ciao%2C%20ho%20completato%20il%20test%20Style%20Advisor%20e%20il%20mio%20profilo%20%C3%A8%3A%20${encodeURIComponent(result.title)}%21%20Vorrei%20una%20consulenza%20personalizzata%20per%20scegliere%20la%20montatura%20ideale%20nel%20vostro%20negozio%20di%20Cesano." 
                                   target="_blank" 
                                   class="quick-btn secondary" 
                                   style="background: var(--champagne); color: var(--midnight);" 
                                   onclick="trackWhatsAppClick('style_advisor_result')">
                                    💬 Prenota Consulenza Cesano
                                </a>
                                <a href="tel:+390245862417" 
                                   class="quick-btn secondary" 
                                   style="background: white; color: var(--midnight);" 
                                   onclick="trackPhoneClick('style_advisor_result')">
                                    📞 Chiama Negozio
                                </a>
                            </div>
                        </div>

                        <button class="quick-btn secondary" onclick="restartStyleTest()" style="margin-right: 10px;">
                            🔄 Rifai il Test
                        </button>
                        <button class="quick-btn secondary" onclick="navigateTo('catalogo')">
                            🛒 Sfoglia Catalogo
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('test-results').innerHTML = resultsHTML;
            document.getElementById('test-results').style.display = 'block';
            
            // Track completion
            trackEvent('style_test_completed', {
                category: 'conversion',
                label: result.title,
                face_shape: styleTestData.face_shape,
                skin_tone: styleTestData.skin_tone,
                hair_color: styleTestData.hair_color,
                style_preference: styleTestData.style_preference
            });
        }

        function calculateStyleResult(data) {
            // Algoritmo per determinare il profilo in base alle risposte
            let profileScore = {
                'classic_elegant': 0,
                'modern_trendy': 0,
                'bold_statement': 0,
                'minimal_chic': 0,
                'artistic_unique': 0
            };

            // Punteggi basati su forma del viso
            const faceShapeProfiles = {
                'oval': ['classic_elegant', 'modern_trendy', 'minimal_chic'],
                'round': ['bold_statement', 'artistic_unique'],
                'square': ['classic_elegant', 'minimal_chic'],
                'heart': ['modern_trendy', 'artistic_unique'],
                'long': ['bold_statement', 'classic_elegant']
            };

            // Punteggi basati su preferenza stile
            const styleProfiles = {
                'classic': ['classic_elegant'],
                'trendy': ['modern_trendy'],
                'bold': ['bold_statement'],
                'minimal': ['minimal_chic'],
                'artistic': ['artistic_unique']
            };

            // Calcola punteggi
            faceShapeProfiles[data.face_shape]?.forEach(profile => profileScore[profile] += 2);
            styleProfiles[data.style_preference]?.forEach(profile => profileScore[profile] += 3);

            // Trova il profilo con punteggio più alto
            const topProfile = Object.keys(profileScore).reduce((a, b) => 
                profileScore[a] > profileScore[b] ? a : b
            );

            // Definizioni dei profili
            const profiles = {
                'classic_elegant': {
                    title: 'Eleganza Classica',
                    emoji: '👑',
                    description: 'Il tuo stile è raffinato e senza tempo. Ami le linee pulite e le forme equilibrate che esaltano la tua bellezza naturale con discrezione ed eleganza.',
                    frameShapes: [
                        { emoji: '👓', name: 'Rettangolari', reason: 'Linee pulite e raffinate' },
                        { emoji: '🔲', name: 'Quadrate Sottili', reason: 'Struttura ma senza eccessi' },
                        { emoji: '⭕', name: 'Ovali Classiche', reason: 'Armonia e proporzione' }
                    ],
                    colors: [
                        { name: 'Nero', hex: '#000000' },
                        { name: 'Tartaruga', hex: '#8B4513' },
                        { name: 'Blu Navy', hex: '#191970' },
                        { name: 'Bordeaux', hex: '#800020' }
                    ],
                    colorAdvice: 'Colori sofisticati e atemporali che esprimono raffinatezza',
                    brands: ['Ray-Ban', 'Persol', 'Oliver Peoples', 'Giorgio Armani']
                },
                'modern_trendy': {
                    title: 'Modernità Trendy',
                    emoji: '✨',
                    description: 'Sei sempre al passo con le tendenze! Ami sperimentare con forme contemporanee e colori alla moda, mantenendo sempre un look fresco e attuale.',
                    frameShapes: [
                        { emoji: '😎', name: 'Cat-Eye Moderne', reason: 'Trend contemporaneo' },
                        { emoji: '🔸', name: 'Geometriche', reason: 'Forme innovative' },
                        { emoji: '⚫', name: 'Tonde Oversize', reason: 'Statement moderno' }
                    ],
                    colors: [
                        { name: 'Oro Rosa', hex: '#E8B4B8' },
                        { name: 'Azzurro', hex: '#87CEEB' },
                        { name: 'Verde Salvia', hex: '#87A96B' },
                        { name: 'Grigio Chiaro', hex: '#D3D3D3' }
                    ],
                    colorAdvice: 'Palette fresca e contemporanea per un look sempre aggiornato',
                    brands: ['Prada', 'Miu Miu', 'Versace', 'Dolce & Gabbana']
                },
                'bold_statement': {
                    title: 'Statement Audace',
                    emoji: '🔥',
                    description: 'Non passi inosservata! Ami fare dichiarazioni di stile con montature che catturano l\'attenzione e riflettono la tua personalità forte e sicura.',
                    frameShapes: [
                        { emoji: '🕶️', name: 'Oversize Bold', reason: 'Massimo impatto visivo' },
                        { emoji: '💎', name: 'Forme Uniche', reason: 'Design distintivo' },
                        { emoji: '🎭', name: 'Decorative', reason: 'Dettagli accattivanti' }
                    ],
                    colors: [
                        { name: 'Rosso', hex: '#FF0000' },
                        { name: 'Viola', hex: '#8A2BE2' },
                        { name: 'Arancione', hex: '#FF8C00' },
                        { name: 'Fucsia', hex: '#FF1493' }
                    ],
                    colorAdvice: 'Colori vibranti e audaci per un look che non passa inosservato',
                    brands: ['Gucci', 'Versace', 'Dolce & Gabbana', 'Moschino']
                },
                'minimal_chic': {
                    title: 'Chic Minimalista',
                    emoji: '🤍',
                    description: 'Less is more è la tua filosofia. Apprezzi la bellezza dell\'essenziale, con linee pulite e colori neutri che esprimono raffinata semplicità.',
                    frameShapes: [
                        { emoji: '⚪', name: 'Tonde Sottili', reason: 'Semplicità elegante' },
                        { emoji: '➖', name: 'Lineari Minimal', reason: 'Geometria pura' },
                        { emoji: '◻️', name: 'Quadre Leggere', reason: 'Struttura discreta' }
                    ],
                    colors: [
                        { name: 'Trasparente', hex: '#F0F8FF' },
                        { name: 'Beige', hex: '#F5F5DC' },
                        { name: 'Grigio Perla', hex: '#C0C0C0' },
                        { name: 'Bianco Ottico', hex: '#FFFFFF' }
                    ],
                    colorAdvice: 'Palette neutra e sofisticata per un eleganza discreta',
                    brands: ['Lindberg', 'Oliver Peoples', 'Silhouette', 'Maui Jim']
                },
                'artistic_unique': {
                    title: 'Unicità Artistica',
                    emoji: '🎨',
                    description: 'La tua creatività si esprime anche negli occhiali! Ami forme originali e colori inaspettati che raccontano la tua personalità artistica e unica.',
                    frameShapes: [
                        { emoji: '🌙', name: 'Forme Asimmetriche', reason: 'Design artistico' },
                        { emoji: '🌈', name: 'Multi-Colore', reason: 'Espressività cromatica' },
                        { emoji: '⭐', name: 'Vintage Rivisitato', reason: 'Stile personale' }
                    ],
                    colors: [
                        { name: 'Turchese', hex: '#40E0D0' },
                        { name: 'Ambra', hex: '#FFBF00' },
                        { name: 'Lavanda', hex: '#E6E6FA' },
                        { name: 'Corallo', hex: '#FF7F50' }
                    ],
                    colorAdvice: 'Colori creativi e inaspettati per esprimere la tua unicità',
                    brands: ['Alain Mikli', 'Anne et Valentin', 'Etnia Barcelona', 'Theo']
                }
            };

            return profiles[topProfile] || profiles['classic_elegant'];
        }

        function restartStyleTest() {
            document.getElementById('test-results').style.display = 'none';
            document.getElementById('test-intro').style.display = 'block';
            styleTestData = {};
            currentQuestion = 0;
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // ===== QR CODE FUNCTIONS - ENHANCED =====
        let qrCode = null;
        const APP_URL = window.location.origin + window.location.pathname;
        
        function generateQRCode() {
            const container = document.getElementById('qr-container');
            const canvas = document.getElementById('qr-canvas');
            
            canvas.innerHTML = '';
            
            const gameUrl = APP_URL + '?game=wheel&ref=qr';
            Logger.log('Generando QR Code per URL:', gameUrl);
            
            try {
                if (typeof QRCode !== 'undefined') {
                    qrCode = new QRCode(canvas, {
                        text: gameUrl,
                        width: 200,
                        height: 200,
                        colorDark: '#0a1628',
                        colorLight: '#ffffff',
                        correctLevel: QRCode.CorrectLevel.M
                    });
                    Logger.log('QR Code generato con QRCode.js');
                } else {
                    const qrImg = document.createElement('img');
                    qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(gameUrl)}`;
                    qrImg.style.borderRadius = '10px';
                    qrImg.alt = 'QR Code per S&V Ruota dei Premi';
                    qrImg.style.maxWidth = '100%';
                    canvas.appendChild(qrImg);
                    Logger.log('QR Code generato con servizio web');
                }
                
                container.style.display = 'block';
                
                trackEvent('qr_generated', {
                    category: 'engagement',
                    label: 'wheel_game',
                    source: 'wheel_game',
                    url: gameUrl
                });
                
            } catch (e) {
                Logger.error('Errore generazione QR Code', e);
                showModal('❌', 'Errore', 'Impossibile generare il QR Code. Riprova più tardi.');
            }
        }
        
        function downloadQR() {
            try {
                const canvas = document.querySelector('#qr-canvas canvas');
                const img = document.querySelector('#qr-canvas img');
                
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = 'SV-Ruota-QR.png';
                    link.href = canvas.toDataURL();
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    Logger.log('QR Code scaricato (canvas)');
                } else if (img) {
                    const link = document.createElement('a');
                    link.download = 'SV-Ruota-QR.png';
                    link.href = img.src;
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    Logger.log('QR Code scaricato (img)');
                }
                
                trackEvent('qr_downloaded', { 
                    category: 'engagement',
                    label: 'wheel_game',
                    source: 'wheel_game' 
                });
                
            } catch (e) {
                Logger.error('Errore download QR', e);
                showModal('❌', 'Errore', 'Impossibile scaricare il QR Code.');
            }
        }
        
        function shareQR() {
            const gameUrl = APP_URL + '?game=wheel&ref=qr';
            
            if (navigator.share) {
                navigator.share({
                    title: '🎮 Gioca alla Ruota S&V!',
                    text: 'Prova a vincere sconti esclusivi girando la ruota di Salmoiraghi & Viganò!',
                    url: gameUrl
                }).then(() => {
                    trackEvent('qr_shared', { 
                        category: 'engagement',
                        label: 'native_share',
                        method: 'native', 
                        source: 'wheel_game' 
                    });
                    Logger.log('QR condiviso tramite API nativa');
                }).catch((e) => {
                    Logger.error('Errore condivisione nativa', e);
                });
            } else {
                const message = `🎮 Gioca alla Ruota S&V e vinci sconti esclusivi! ${gameUrl}`;
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
                trackEvent('qr_shared', { 
                    category: 'engagement',
                    label: 'whatsapp_fallback',
                    method: 'whatsapp', 
                    source: 'wheel_game' 
                });
                Logger.log('QR condiviso tramite WhatsApp fallback');
            }
        }
        
        function copyLink() {
            const gameUrl = APP_URL + '?game=wheel&ref=qr';
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(gameUrl).then(() => {
                    showModal('✅', 'Link copiato!', 'Il link è stato copiato negli appunti. Condividilo con chi vuoi!');
                    trackEvent('qr_link_copied', { 
                        category: 'engagement',
                        label: 'clipboard_api',
                        source: 'wheel_game' 
                    });
                    Logger.log('Link copiato tramite Clipboard API');
                }).catch((e) => {
                    Logger.error('Errore copia clipboard', e);
                    fallbackCopyLink(gameUrl);
                });
            } else {
                fallbackCopyLink(gameUrl);
            }
        }
        
        function fallbackCopyLink(gameUrl) {
            try {
                const textArea = document.createElement('textarea');
                textArea.value = gameUrl;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                showModal('✅', 'Link copiato!', 'Il link è stato copiato negli appunti. Condividilo con chi vuoi!');
                trackEvent('qr_link_copied', { 
                    category: 'engagement',
                    label: 'fallback_method',
                    source: 'wheel_game' 
                });
                Logger.log('Link copiato tramite fallback');
            } catch (e) {
                Logger.error('Errore copia fallback', e);
                showModal('❌', 'Errore', 'Impossibile copiare il link. Condividi manualmente: ' + gameUrl);
            }
        }

        // ===== MODAL FUNCTIONS =====
        function showModal(emoji, title, content) {
            const modalBody = document.getElementById('modal-body');
            modalBody.innerHTML = `
                <div style="text-align: center;">
                    ${emoji ? `<div style="font-size: 60px; margin-bottom: 20px;">${emoji}</div>` : ''}
                    ${title ? `<h2 style="font-family: 'Playfair Display', serif; font-size: 32px; color: var(--midnight); margin-bottom: 20px;">${title}</h2>` : ''}
                    ${content}
                </div>
            `;
            document.getElementById('modal').classList.add('active');
            
            // Track modal open
            trackEvent('modal_opened', {
                category: 'engagement',
                label: title || 'unknown',
                modal_title: title || 'unknown'
            });
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // ===== PWA INSTALL - SAFARI COMPATIBLE =====
        let deferredPrompt;
        let isFirstVisit = !SafeStorage.getItem('hasVisited');
        
        function isAppInstalled() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }
        
        function showInstallInstructions() {
            const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let instructions = '';
            
            if (isIOS) {
                instructions = `
                    <div style="text-align: center;">
                        <div style="font-size: 60px; margin-bottom: 20px;">📱</div>
                        <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 20px;">Installa S&V sul tuo iPhone</h2>
                        <div style="text-align: left; max-width: 300px; margin: 0 auto;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">1</div>
                                <p>Tocca il pulsante Condividi <span style="color: var(--sapphire);">↗</span> in basso</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">2</div>
                                <p>Scorri e tocca "Aggiungi alla schermata Home" ➕</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">3</div>
                                <p>Tocca "Aggiungi" in alto a destra</p>
                            </div>
                        </div>
                        <p style="color: var(--steel); font-size: 14px; margin-top: 20px;">L'icona S&V apparirà sul tuo schermo!</p>
                    </div>
                `;
            } else if (isAndroid) {
                instructions = `
                    <div style="text-align: center;">
                        <div style="font-size: 60px; margin-bottom: 20px;">📱</div>
                        <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 20px;">Installa S&V sul tuo Android</h2>
                        <p style="color: var(--steel); margin-bottom: 30px;">Tocca "Installa" quando appare il messaggio in basso, oppure:</p>
                        <div style="text-align: left; max-width: 300px; margin: 0 auto;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">1</div>
                                <p>Tocca i 3 puntini ⋮ in alto a destra</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">2</div>
                                <p>Seleziona "Aggiungi a schermata Home"</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <div style="background: var(--champagne); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">3</div>
                                <p>Conferma toccando "Aggiungi"</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                instructions = `
                    <div style="text-align: center;">
                        <div style="font-size: 60px; margin-bottom: 20px;">💻</div>
                        <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 20px;">Salva S&V Boutique</h2>
                        <p style="color: var(--steel);">Aggiungi questa pagina ai preferiti per accesso rapido</p>
                        <p style="margin-top: 20px;">Premi <strong>Ctrl+D</strong> (Windows) o <strong>Cmd+D</strong> (Mac)</p>
                    </div>
                `;
            }
            
            showModal('', '', instructions + `
                <button class="quick-btn" style="margin-top: 30px; width: 100%;" onclick="closeModal()">Ho capito!</button>
            `);
        }
        
        window.addEventListener('beforeinstallprompt', (e) => {
            Logger.log('Prompt installazione disponibile');
            e.preventDefault();
            deferredPrompt = e;
            
            if (isFirstVisit && !isAppInstalled()) {
                setTimeout(() => {
                    document.getElementById('install-prompt').classList.add('show');
                }, 3000);
            }
        });

        function installApp() {
            if (deferredPrompt) {
                Logger.log('Mostrando prompt installazione...');
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    Logger.log('Scelta utente:', choiceResult.outcome);
                    if (choiceResult.outcome === 'accepted') {
                        trackEvent('app_installed', {
                            category: 'conversion',
                            label: 'pwa_install',
                            value: 1
                        });
                        SafeStorage.setItem('appInstalled', 'true');
                    }
                    deferredPrompt = null;
                });
            } else {
                Logger.log('Nessun prompt disponibile, mostrando istruzioni...');
                showInstallInstructions();
            }
            hideInstallPrompt();
        }

        function hideInstallPrompt() {
            document.getElementById('install-prompt').classList.remove('show');
        }

        // ===== ERROR HANDLING =====
        window.addEventListener('error', function(e) {
            Logger.error('Errore JavaScript:', {
                message: e.message,
                filename: e.filename,
                lineno: e.lineno,
                colno: e.colno,
                error: e.error
            });
            
            // Nascondi preloader in caso di errore
            hidePreloader();
        });

        window.addEventListener('unhandledrejection', function(e) {
            Logger.error('Promise rejection non gestita:', {
                reason: e.reason,
                promise: e.promise
            });
        });

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            Logger.log('App inizializzata');
            
            // Initialize privacy
            initPrivacy();
            
            // Check URL parameters for QR tracking
            const urlParams = new URLSearchParams(window.location.search);
            const gameParam = urlParams.get('game');
            const refParam = urlParams.get('ref');
            
            if (refParam === 'qr') {
                setTimeout(() => {
                    trackQRScan();
                    Logger.log('QR Code scansionato');
                    
                    if (gameParam === 'wheel') {
                        navigateTo('fortune');
                        showModal('🎮', 'Benvenuto al gioco!', 
                            'Gira la ruota e prova a vincere sconti esclusivi!<br><br>' +
                            '<button class="quick-btn" onclick="closeModal()" style="margin-top: 15px;">Inizia a giocare! 🎯</button>');
                    }
                }, 1000);
            }
            
            // First visit handling
            if (isFirstVisit) {
                setTimeout(() => {
                    if (!isAppInstalled()) {
                        showInstallInstructions();
                    }
                    SafeStorage.setItem('hasVisited', 'true');
                }, 2000);
            }
            
            Logger.log('Configurazione completata', {
                isFirstVisit,
                isAppInstalled: isAppInstalled(),
                userAgent: navigator.userAgent,
                analyticsEnabled
            });
        });

    </script>
</body>
    </html>
